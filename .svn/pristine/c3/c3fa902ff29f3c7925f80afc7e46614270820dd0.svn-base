<!--应急通信 -->
<template>
  <div class = "contentbox">
     <Header v-if = "or_he == '0'"  explaincode = "w_yj_bzhd"  backurl =  "/unicomwisdomeyes/yhzl_index"  title="山东联通网络智慧眼-沿黄战略" subtitle="应急通信"></Header>
     <Header v-else explaincode = "w_yj_bzhd" title = "山东联通网络智慧眼-网" subtitle = "应急"></Header>
    <div class = "contentbody">
 
      <div class = "rightbox flex colflex">

         <div class = "box-item flex colflex flex1">
           <div class = "item-title titlefont">
             <span>保障活动</span>
             <div class="checkgroupbox">
                <el-checkbox-group v-model="bzhd_checkList">
                  <el-checkbox class="checkstate01" label="01">进行中</el-checkbox>
                  <el-checkbox class="checkstate00" label="00">已完成</el-checkbox>
                  <el-checkbox class="checkstate02" label="02">计划中</el-checkbox>
                </el-checkbox-group>
             </div>
           </div>

           <div  class = "flex1">
             <el-table
              class = "custom_table"
              id = "bzhdTable"
              :data="fiter_bzhd_tableData"
              style="width: 100%" height="480px" size = "mini" :row-class-name = "classNameFn" @row-click = "rowClickFn">
              <el-table-column
                v-for="(col, index) in bzhd_colums" :key="index"
                :prop="col.filed"
                :label="col.title"
                :width="col.width || 'auto'" :align="col.align || 'center'" show-overflow-tooltip>
              </el-table-column>
            </el-table>
           </div>
         </div>
   
         <div class = "box-item flex colflex flex1">
           <div class = "item-title titlefont">
             <span>{{rowttabStatus2 == '1' ? '当年': '历年'}}社会化保障收入</span>
             <span class = "tunit">(万元)</span>
           </div>

           <div class = "rowttabs">
             <span class="rowttabs-item" :class="{'active': rowttabStatus2 == '1'}" @click="rowttabsClick2('1')">当年</span>
             <span class="rowttabs-item" :class="{'active': rowttabStatus2 == '2'}" @click="rowttabsClick2('2')">历年</span>
           </div>

           <div  class = "flex1">
              <div class="chartbox" id = "chart_shhbzfw"  v-show="rowttabStatus2 == '1'"></div>
              <div class="chartbox" id = "chart_shhbzfw2"  v-show="rowttabStatus2 == '2'"></div>
            </div>
         </div>

      </div>
      <div class = "centerbox flex colflex">
        <!-- <div class="centTab">
          <div class="centtabitem titlefont" :class="{'active': tabstatus == '0201'}" @click="tabStatusFn('0201')">
            <span>应急车辆</span>
          </div>
          <div class="centtabitem titlefont" :class="{'active': tabstatus == '0202'}" @click="tabStatusFn('0202')">
            <span>保障活动</span>
          </div>
        </div> -->
        <div class="gistitle">
          <span class="titlefont">{{gisTitle}}</span>
        </div>
        <iframe  ref="gisiframe" id="gisiframe" :src="iframeSrc"  style="widh: 100%; height: 100%" frameborder="0"></iframe>
      </div>
      <div class = "leftbox flex colflex">
      
        <div class = "box-item flex colflex flex1">
           <div class = "item-title titlefont">
             <span>分类统计</span>
             <span v-show = "false">{{fltjSelectType}}</span>
           </div>
           <div class="rowttabs">
             <el-select  popper-class= "initselect" v-model="selectVal1" placeholder="请选择" style="width: 108px; margin-right: 10px">
              <el-option
                v-for="item in selectOptions1"
                :key="item.value"
                :label="item.label"
                :value="item.value">
              </el-option>
            </el-select>

             <el-select  popper-class= "initselect" v-model="selectVal2" placeholder="请选择" style="width: 68px; margin-right: 10px">
              <el-option
                v-for="item in selectOptions2"
                :key="item.value"
                :label="item.label"
                :value="item.value">
              </el-option>
            </el-select>

            
           </div>
            
            <div  class = "flex1">
              <div class="chartbox" id = "chart_fltj"></div>
            </div>
        </div>

        <div class = "box-item flex colflex flex1">
           <div class = "item-title titlefont">
             <span>趋势分析</span>
           </div>
           <div class = "rowttabs">
             <span class="rowttabs-item" :class="{'active': qsrowttabStatus == '1'}" @click="qsrowttabStatus = 1">频次</span>
             <span class="rowttabs-item" :class="{'active': qsrowttabStatus == '2'}" @click="qsrowttabStatus = 2">台班</span>
             <span class="rowttabs-item" :class="{'active': qsrowttabStatus == '3'}" @click="qsrowttabStatus = 3">人力</span>
           </div>


             <div  class = "flex1" style="position: relative;">
              <div class="chartbox" id = "chart_zbsyl"></div>
            </div>
        </div>


     
         <div class = "box-item flex colflex flex1">
           <div class = "item-title titlefont">
             <span>地市统计</span>
              <!-- <span class = "tunit">(次)</span> -->
           </div>
           <div class = "rowttabs">
             <span class="rowttabs-item" :class="{'active': rowttabStatus == '1'}" @click="rowttabsClick('1')">当年</span>
             <span class="rowttabs-item" :class="{'active': rowttabStatus == '2'}" @click="rowttabsClick('2')">历年</span>
           </div>

            <div  class = "flex1">
              <div class="chartbox" id = "chart_yjbztj" v-show="rowttabStatus == '1'"></div>
              <div class="chartbox" id = "chart_yjbztj2"  v-show="rowttabStatus == '2'"></div>
            </div>
         </div>

      </div>

 
    </div>
      <el-dialog :visible.sync="isDialogShow" width="50%" :modal-append-to-body='false'>
        <div class="dialogCon">
          <div class="dialogTitle">
            <div class="left">{{carnamt}}简介</div>
          </div>
          <div class="dialogTableBg">
             <div class = "cardetailbox">
                <div class="imgbox">
                  <img :src="'/view/images/' + carInfo.car_images" alt="" srcset="">
                </div>
                <div class="felx1 fontbox">
                  <p>{{carInfo.car_name}}</p>
                  <p>{{carInfo.car_remark}}</p>
                  <p>车辆能力:{{carInfo.car_power}}</p>
                  <p><span style="margin-right: 15px">{{carInfo.car_user}} </span> <span>{{carInfo.car_user_tel}}</span></p>
                </div>
             </div>
          </div>
        </div>
      </el-dialog>


      <el-dialog :visible.sync="isDialogShow2" width="50%" :modal-append-to-body='false'>
        <div class="dialogCon">
          <div class="dialogTitle">
            <div class="left">保障活动详情</div>
          </div>
          <div class="dialogTableBg">
             <div class = "videobox" style="height: auto" v-show="hddetail">
                     <swiper class="swiperClass" :options="swiperOption" ref="mySwiper" >
                      <!-- slides -->
                          <swiper-slide>
                            <img src="./img/bzhd1.jpg" alt="">
                          </swiper-slide>
                          <swiper-slide>
                             <img src="./img/bzhd2.jpg" alt="">
                          </swiper-slide>
                          <swiper-slide>
                             <img src="./img/bzhd3.jpg" alt="">
                          </swiper-slide>
                          <swiper-slide>
                             <video width="100%" height="100%" controls id="myVideo">
                              <source src="./img/qxsvideo.mp4"  type="video/mp4">
                                您的浏览器不支持 HTML5 video 标签。
                              </video>
                          </swiper-slide>
         
                          <!-- Optional controls -->
                          <div class="swiper-pagination"  slot="pagination"></div>
                          <div class="swiper-button-prev" slot="button-prev"></div>
                          <div class="swiper-button-next" slot="button-next"></div>
                     </swiper>

                    <div class = "hddetali">
                      <h3>山东联通完成栖霞金矿事故现场通信保障</h3>
                      <div>
                        <div>1月10日 14:00 山东栖霞笏山金矿发生爆炸，22人被困。</div>
                         <div> 1月17日 14:03 事故救援孔打通。</div>
                         <div>1月18日 08:14 被困工人传回纸条。</div>
                         <div> 1月18日 17:33 首次实现与井下矿工通话。</div>
                        <div>1月24日 11:14 事故中第一名矿工成功升井。</div>
                        <div>1月24日 15:18 事故已取得联系的11人全部升井。</div>
                       
                        <div>1月10日金矿发生爆炸，截止到1月25日凌晨，除1人基本确定死亡仍未升井外，其余11名
                        幸存矿工和10名死难矿工已全部升井，这场已历时14天的“地心大营救”仍在延续，一串
                        串时间，牵动着全国人民的心，一个个数据，见证了中国人民“不抛弃、不放弃”的精
                        神。</div>
                        <div> 在这场地心救援中，山东联通秉承央企担当，快速响应，再次展示了国家应急通信铁军的
                        风采。</div>
                        <div>
                        1月24日13:00，山东联通机动通信局接到山东省消防总队的紧急求援，需对矿难坑道进行
                        4G手机信号的恢复和覆盖，以便抢险队员的4G单兵和通信联络。收到任务后，机动局马
                        上进行部署，召集技术专家和设备厂家，进行技术攻关，克服了500米远距离供电、免安
                        装等困难，制定了500米以下矿道4G信号覆盖的解决方案，并提交现场救援指挥部进行讨
                        论。同时，机动局紧急组织抢险队伍，由省公司领导带队携带应急装备紧急援驰栖霞。从
                        13:00消防总队提出需求，14:00机动局提交保障方案，19:00救援队奔袭500多公里抵达
                        救援现场并展开通信保障实施工作，机动局雷厉风行的作风和快速响应，获得了矿难指挥
                        部和消防总队各级领导的一致肯定和好评，并在随后的表彰大会上，授予了山东联通“牢
                        记生命至上，聚力笏山救援”锦旗。
                        </div>
                       
                        
                      </div>
                    </div>

             </div>
             <div v-show="!hddetail" style="height: 400px">

             </div>
            
          </div>
        </div>
      </el-dialog>

       <Footer v-if="or_he == '0'" :tabdata="tabdata2" class="initfoot"></Footer>
       <Footer v-else :tabdata="tabdata" class="initfoot"></Footer>
  </div>
</template>

<script>
var self = null
import Header from '@/components/resource_visual/header2';
import Footer from '@/components/resource_visual/footer';
import echarts_zq from '@/views/resource_visual/echarts_component/echarts_zq';
import vueSeamlessScroll from 'vue-seamless-scroll'
import store from 'store'
import { mapState } from 'vuex'
import  serviceApi from '@/api/tactics'
import { swiper, swiperSlide } from 'vue-awesome-swiper'
import '@/assets/swiper.css'
var _ = require('@/utils/lodash.js')

var Qs = require('@/utils/qs.js')
import initEchart from './initechart'
window['bzhdTable_timer'] = null;

var chart_yjbztj1 = null
var chart_shhbzfw1 = null
var chart_yjbztj2 = null
var chart_shhbzfw2 = null
export default {
  data () {
    return {
      or_he: '1',
      selectOptions1: [{
        value: '1',
        label: '按类别统计'
      }, {
        value: '2',
        label: '按等级统计'
      }],
      selectVal1: '1',

      selectOptions2: [{
        value: '1',
        label: '当年'
      }, {
        value: '2',
        label: '累计'
      }],
      selectVal2: '1',
      gisTitle: '山东省',
      swiperOption:{
          // 如果需要分页器
          pagination: {
            el: '.swiper-pagination',
          },
          // 如果需要前进后退按钮
          navigation: {
            nextEl: '.swiper-button-next',
            prevEl: '.swiper-button-prev',
          },
          //循环
          loop:true,
          //每张播放时长3秒，自动播放
          autoplay: false,
          //滑动速度
          speed:1000,
          // delay:1000  
      },
      hddetail: false,
      carnamt: '',
      isDialogShow: false,
      isDialogShow2: false,
      bzhdTable_timer: null,
      rowttabStatus: '1',
      rowttabStatus2: '1',
      bzhd_checkList: ['00', '01', '02'],
      cityCode: '370000',
      iframeSrc: '',
      yjnl_colums: [
        {title: '地市', filed: 'name', width: '60'},
        {title: '基站车', filed: 'capacity_basestation_car'},
        {title: '电源车', filed: 'capacity_power_car'},
        {title: '其它车', filed: 'capacity_other_car'},
        {title: '卫星装备', filed: 'capacity_satellite_equipment', width: '60'},
        {title: '应急装备', filed: 'capacity_emergency_equipment', width: '60'},
        {title: '人员', filed: 'capacity_crew'},
        {title: '应急物资', filed: 'capacity_emergency_supplies', width: '60'}
      ],
      yjnl_tableData: [],
    //  活动名称、活动地点、保障单位、保障车辆（数量）、人员（数量）、收入（万元
      bzhd_colums: [
        {title: '活动名称', filed: 'activity_name', width: '120', align: 'left'},
        {title: '活动地点', filed: 'activity_address', },
        {title: '保障单位', filed: 'safeguard_orgname'},
        {title: '保障车辆', filed: 'safeguard_car_cnt', width: '60'},
        {title: '人员', filed: 'safeguard_staff_cnt', width: '40'},
        {title: '收入(万元)', filed: 'safeguard_income'},
      ],
      bzhd_tableData: [], // 保障活动
      tabstatus: '0202',
      gisQueryParams: {},
      queryParams: {},
      gisMapData: {},
      mapLevel: 1,
      areaCode: '',
      carInfo: {},
       tabdata: [
        {title: '应急能力', active: false, href: '/unicomwisdomeyes/emergencies_power'},
        {title: '保障活动', active: true, href: '/unicomwisdomeyes/emergencies_safeguard'},
      ],
      tabdata2: [
        {title: '应急能力', active: false, href: '/unicomwisdomeyes/emergencies_power?pagesource=yhzl'},
        {title: '保障活动', active: true, href: '/unicomwisdomeyes/emergencies_safeguard?pagesource=yhzl'},
      ],
      fltjData: {},
      qsfxDatas: [],
      qsrowttabStatus: 1
    }
  },
  components: {
    Header,
    Footer,
    vueSeamlessScroll,
    swiper,
    swiperSlide
  },
  created() {
    self = this;
    if (this.$route.query.pagesource && this.$route.query.pagesource == 'yhzl') {
      this.or_he = '0'
    } else {
      this.or_he = '1'
    }
  },
  mounted () {
    var initArea_id = '370000'
    this.mapLevel = '1';
    this.initGisMap(initArea_id);

     // 注册地图事件
    window.addEventListener('message',self.gismapListener, true);
    this.initService()
    
  },
  watch: {
    fiter_bzhd_tableData (val){
      if (val && val.length > 0) {
        var self = this
        this.$nextTick(() => {
          var timer = new self.$eltable_scrollAuto('bzhdTable')
        })
      }
       
    },
    fltjSelectType (val) {
      this.renderFltjChart()
    },
    qsrowttabStatus (val) {
      this.renderQsfxChhart()
    },
    isDialogShow2 (val) {
      if (!val) {
        var myVideo = document.getElementById("myVideo");
        myVideo.pause();
      }
    }
  },
  computed: {
    ...mapState({
       searchDate: state => state.resource.searchDate,
    }),
    swiper() {
      return this.$refs.mySwiper.swiper
    },
    fiter_bzhd_tableData () {
      var dataList = [];
      var bzhd_tableData = this.bzhd_tableData;
      var bzhd_checkList = this.bzhd_checkList;
      bzhd_tableData.forEach(item => {
        if ( bzhd_checkList.indexOf(item.activity_state) > -1) {
          dataList.push(item)
        }
      })
      return dataList
    },
     fltjSelectType () {
        return this.selectVal1 + ''  + this.selectVal2
     }
  },
  methods: {
    // 分类统计
    serviceWxFltj () {
      var param = {
        or_he: this.or_he,
        "cityCode": this.cityCode
      };
      this.fltjData = {}
       serviceApi.serviceWxFltj(param).then(res => {
          if (res.rspCode == '0000') {
            this.fltjData = res.result.data[0] || {}
            this.renderFltjChart()
          } else {
           this.$message.error(res.rspMsg)
          };
       })
    },
    // 趋势分析
    serviceWxQsfx  () {
      var param = {
        or_he: this.or_he,
        "cityCode": this.cityCode,
      };
      serviceApi.serviceWxQsfx(param).then(res => {
        
        if (res.rspCode == '0000') {
         var datal =  res.result.data || []
          datal.forEach(item => {
            item.initx_year = item.year_time.substr(0, 4) || ''
          })
        datal = _.sortBy(datal, function (item) {
          return Number(item.year_time)
        });
         this.qsfxDatas = datal;
         this.renderQsfxChhart()
        } else {
          this.$message.error(res.rspMsg)
        };
      })
    },
    renderQsfxChhart () {
      var datal =   this.qsfxDatas;
      var status =  this.qsrowttabStatus;
      var month = '同'
      if (datal.length > 0) {
        month = parseInt(datal[0].year_time.substring(datal[0].year_time.length-2))  
      }
      var clparams = {
        domId: 'chart_zbsyl',
        legend: [],
        xData: datal.map(item => {
          return item.initx_year
        }),
        barData: [],
        lineData: [],
      }
      if (status == '1') {
        clparams.legend = ['历年活动频次', `历年${month}月份活动频次`] 
        clparams.barData = datal.map(item => {
          return item.safeguard_times_year
        })
        clparams.lineData = datal.map(item => {
          return item.safeguard_times
        })
      } else if (status == '2') {
        clparams.legend = ['历年活动使用台班', `历年${month}月份活动使用台班`] 
        clparams.barData = datal.map(item => {
          return item.safeguard_car_nums_year
        })
        clparams.lineData = datal.map(item => {
          return item.safeguard_car_nums
        })
      } else if (status == '3') {
        clparams.legend = ['历年活动人力', `历年${month}月份活动人力`] 
        clparams.barData = datal.map(item => {
          return item.safeguard_staff_nums_year
        })
        clparams.lineData = datal.map(item => {
          return item.safeguard_staff_nums
        })
      }
      
      initEchart.initEchart_barLine2(clparams)
    },
    renderFltjChart() {
      var chartParams = {
        domId: 'chart_fltj',
        name: '',
        legend: ['会议', '文体赛事', '自然灾害', '培训演练', '其他'],
        data: []
      }
      var status = this.fltjSelectType;
      var datal = this.fltjData
      if (status == '11') {
        chartParams.name = '类别统计';
        chartParams.legend = ['会议', '文体赛事', '自然灾害', '培训演练', '其他'];
        chartParams.data = [
          {value: datal.meeting, name: '会议'},
          {value: datal.sports, name: '文体赛事'},
          {value: datal.natural_disaster, name: '自然灾害'},
          {value: datal.exercise, name: '培训演练'},
          {value: datal.other, name: '其他'},
        ]
      } else if (status == '12') {
        chartParams.name = '类别统计';
        chartParams.legend = ['会议', '文体赛事', '自然灾害', '培训演练', '其他'];
        chartParams.data = [
          {value: datal.leiji_meeting, name: '会议'},
          {value: datal.leiji_sports, name: '文体赛事'},
          {value: datal.leiji_natural_disaster, name: '自然灾害'},
          {value: datal.leiji_exercise, name: '培训演练'},
          {value: datal.leiji_other, name: '其他'},
        ]
      } else if (status == '21') {
        chartParams.name = '等级统计';
        chartParams.legend = ['国家级及以上', '省级', '地市级及以下'];
        chartParams.data = [
          {value: datal.nat_level, name: '国家级及以上'},
          {value: datal.prov_level, name: '省级'},
          {value: datal.city_level, name: '地市级及以下'},
        ]
      } else if (status == '22') {
        chartParams.name = '等级统计';
        chartParams.legend = ['国家级及以上', '省级', '地市级及以下'];
        chartParams.data = [
          {value: datal.leiji_nat_level, name: '国家级及以上'},
          {value: datal.leiji_prov_level, name: '省级'},
          {value: datal.leiji_city_level, name: '地市级及以下'},
        ]
      }
       initEchart.initPieCat2(chartParams)
    },
    serviceWxLnbz () {
       var param = {
         or_he: this.or_he,
        "cityCode": this.cityCode
      }
      serviceApi.serviceWxLnbz(param).then(res => {
        if (res.rspCode == '0000') {
            res.result.data = (res.result.data || [])
            var datal = _.sortBy(res.result.data, function (item) {
                return Number(item.year_time)
             });
             var chartParams = {
              domId: 'chart_yjbztj2',
              name: '急保障统计',
              uni: '',
              xData: [],
              data: []
            }
            var chartParams2 = {
              domId: 'chart_shhbzfw2',
              name: '社会化保障收入',
              uni: '',
              xData: [],
              data: []
            }
            datal.forEach(item => {
                chartParams.xData.push(item.year_time)
                chartParams.data.push(item.safeguard_times);

                chartParams2.xData.push(item.year_time)
                chartParams2.data.push(item.safeguard_income);
            });

            chart_yjbztj2 = new echarts_zq.initEchart_singLine(chartParams)
            chart_shhbzfw2 = new echarts_zq.initEchart_singLine(chartParams2)
             
         } else {
           this.$message.error(res.rspMsg)
         }
      })
    },

    serviceWxClsm (carname) {
      var param = {
        or_he: this.or_he,
        carName: carname
      }
      serviceApi.serviceWxClsm(param).then(res => {
        
        this.carInfo = {}
        if (res.rspCode == '0000') {
            this.carInfo = res.result.data[0] || {}
         } else {
           this.$message.error(res.rspMsg)
         }
      })
    },
    rowttabsClick (type) {
      this.rowttabStatus = type;
      if(type == 1) {
        this.$nextTick(() => {
         chart_yjbztj1 && chart_yjbztj1.$resize()
        })
      } else {
         this.$nextTick(() => {
          chart_yjbztj2 && chart_yjbztj2.$resize()
        })
      }
    },
    rowttabsClick2 (type) {
      this.rowttabStatus2 = type;
      if(type == 1) {
        this.$nextTick(() => {
         chart_shhbzfw1 && chart_shhbzfw1.$resize()
        })
      } else {
        this.$nextTick(() => {
          chart_shhbzfw2 &&  chart_shhbzfw2.$resize()
        })
      }
      
    },
    rowClickFn (params) {
      this.hddetail = false
      if ( params.activity_name == '栖霞招远金矿救援') {
        this.hddetail = true
      }
      this.isDialogShow2 = true
    },
    classNameFn (params) {
      return 'rowclassname_' + params.row.activity_state;
    },
    initService () {
      this.yjBztjsr() //应急保障统计
      this.serviceWxLnbz()
      this.bzhdList() //保障活动
      this.serviceWxFltj()
      this.serviceWxQsfx()
      // this.zbsyList() // 装备使用率
       // this.yjnlList() //应急能力
     
    },
    yjnlList () {
       var param = {
        "cityCode": this.cityCode
      }
      this.yjnl_tableData = []
      serviceApi.yjnlList(param).then(res => {
         if (res.rspCode == '0000') {
            this.yjnl_tableData = res.result.data || []
         } else {
           this.$message.error(res.rspMsg)
         }

         this.$nextTick(() => {
           window.setTimeout(function (params) {
           var timer =  new self.$eltable_scrollAuto('yjnlTable')
           }, 3000)
         })
       
      })
    },
    bzhdList  () {
      var param = {
        or_he: this.or_he,
        "cityCode": this.cityCode
      }
      this.bzhd_tableData = []
      serviceApi.bzhdList(param).then(res => {
        if (res.rspCode == '0000') {
            this.bzhd_tableData = res.result.data || []
         } else {
           this.$message.error(res.rspMsg)
         }
      })
    },
 
    //应急保障统计
    yjBztjsr () {
        var param = {
          or_he: this.or_he,
          "cityCode": this.cityCode
        };
        serviceApi.yjBztjsr(param).then(res => {
          if (res.rspCode == '0000') {
             res.result.data = (res.result.data || [])
             var resData = _.cloneDeep(res.result.data)
             var averData = (resData.filter(item => {
               return item.code == '370000'
             })[0] || {});
             res.result.data = resData.filter(item => {
               return item.code != '370000'
             })
             // 应急保障统计
             var chartdata1 = {
                domId: 'chart_yjbztj',
                uni: '',
                data: []
             };
             var datasarr = []
             var chartdata1_order = _.sortBy(res.result.data, function (item) {
                return Number(item.safeguard_times_sort)
             });
             chartdata1_order.forEach(item => {
                let ditem = {'name': item.name, val: item.safeguard_times}
                chartdata1.data.push(ditem)
             });
             chart_yjbztj1 = new echarts_zq.initEchart_pm(chartdata1)
            // 社会化保障收入
             var chartdata2 = {
              domId: 'chart_shhbzfw',
              zoomVal: 100,
              name: '社会化保障收入',
              uni: '',
              line_markLine: averData.safeguard_income,
              xData: [],
              data: []
            }
           
            var chartdata2_order = _.sortBy(res.result.data, function (item) {
                return Number(item.safeguard_income_sort)
             });

             chartdata2_order.forEach(item => {
                chartdata2.xData.push(item.name)
                chartdata2.data.push(item.safeguard_income);
            });
           chart_shhbzfw1 = new echarts_zq.initEchart_singLine(chartdata2)
          } else {
            this.$message.error(res.rspMsg)
          }
        })
    },
   // 无线装备使用率及收入查询接口
    zbsyList () {
      var self = this;
      var param = {
        "cityCode": this.cityCode
      }
      serviceApi.zbsyList(param).then(res => {
        if (res.rspCode == '0000') {

             res.result.data = (res.result.data || [])
             // 装备使用率
              var zbsyl_edata = {
                domId: 'chart_zbsyl',
                data: []
              }
              var zbsylData = _.sortBy(res.result.data, function (item) {
                return Number(item.usage_sort)
              });
              zbsylData.forEach(item => {
                let ditem = {'name': item.emergency_resource_type, val: item.usage_freq}
                zbsyl_edata.data.push(ditem)
              });
              echarts_zq.initEchart_pm(zbsyl_edata, chartClickBk)
             //  装备产出比
              var zbccb_edata = {
                domId: 'chart_zbcc',
                data: []
              };
              var zbzcbData = _.sortBy(res.result.data, function (item) {
                return Number(item.income_sort)
              });
              zbzcbData.forEach(item => {
                let ditem = {'name': item.emergency_resource_type, val: item.income}
                zbccb_edata.data.push(ditem)
              });
              echarts_zq.initEchart_pm(zbccb_edata, chartClickBk)

              function chartClickBk(params) {
                  self.carnamt = params.value;
                  self.serviceWxClsm(params.value)
                  self.isDialogShow = true
              }

            
         } else {
           this.$message.error(res.rspMsg)
         }
      })
    },

    gismapListener (e) {
      if (e.data.message == 'levelSwitch') {
         self.gisTitle = e.data.area_name || '山东省'
         self.mapLevel = e.data.level
         self.areaCode = e.data.area_id;
         self.gisMapData = e.data;
         self.gisQueryParams = Object.assign({},  self.gisQueryParams, e.data)
         self.gisQueryParams.area_name = '';
         console.log('message', e.data)
         self.cityCode = (e.data.area_id || '370000');
        //  self.initService()
      } else if (e.data.message == 'clickAct'){
          // e.data.actName == "2021世界牡丹大会";
          this.hddetail = false
          if ( e.data.actName == '栖霞招远金矿救援') {
            this.hddetail = true
          }
          this.isDialogShow2 = true
      }
    },
     initGisMap (initArea_id) {
      // 初始化地图参数
        this.gisQueryParams =  {
             yanhuang: this.or_he,
             level: this.mapLevel,
              sceneid: 4,
              gis_sceneid: this.tabstatus,
              area_id: initArea_id || '370000',
              poi_city_id: '',
              system_type: 'C40',
              login_no:  store.get('staffId') || '',
              timest:  this.$store.state.resource.searchDate
          };
          var gisQueryParams = JSON.parse(JSON.stringify(this.gisQueryParams))
          this.iframeSrc = window.gis_iframeSrc +  `/smartEyes?${Qs.stringify(gisQueryParams)}`;
          
    },
    tabStatusFn (type) {
      this.tabstatus = type;
      var gisQueryParams = JSON.parse(JSON.stringify(this.gisQueryParams));
      gisQueryParams.message = "changeType";
      gisQueryParams.gis_sceneid = type;
      this.$refs['gisiframe'].contentWindow.postMessage(gisQueryParams, '*')
    },
    initEchart () {
     // 基站车、电源车、短波车、指挥车、保障车、工具车、通勤车、集群车、卫星车、动中通
      //  var params1 = {
      //   domId: 'chart_zbsyl',
      //   uni: '(次)',
      //   data: [
      //     {'name': '基站车', val: 1000},
      //     {'name': '电源车', val: 983},
      //     {'name': '短波车', val: 823},
      //     {'name': '保障车', val: 734},
      //     {'name': '通勤车', val: 653},
      //     {'name': '集群车', val: 612},
      //     {'name': '卫星车', val: 567},
      //     {'name': '动中通', val: 432},
      //   ]
      // }
      // echarts_zq.initEchart_pm(params1)

      // var params2 = {
      //   domId: 'chart_zbcc',
      //    uni: '(万元)',
      //   data: [
      //     {'name': '基站车', val: 1000},
      //     {'name': '电源车', val: 983},
      //     {'name': '短波车', val: 823},
      //     {'name': '保障车', val: 734},
      //     {'name': '通勤车', val: 653},
      //     {'name': '集群车', val: 612},
      //     {'name': '卫星车', val: 567},
      //     {'name': '动中通', val: 432},
      //   ]
      // }
      // echarts_zq.initEchart_pm(params2)


      // var params3 = {
      //   domId: 'chart_yjbztj',
      //   uni: '(次)',
      //   data: [
      //     {'name': '基站车', val: 1000},
      //     {'name': '电源车', val: 983},
      //     {'name': '短波车', val: 823},
      //     {'name': '保障车', val: 734},
      //     {'name': '通勤车', val: 653},
      //     {'name': '集群车', val: 612},
      //     {'name': '卫星车', val: 567},
      //     {'name': '动中通', val: 432},
      //   ]
      // }
      // echarts_zq.initEchart_pm(params3)

      

      // var params4 = {
      //   domId: 'chart_shhbzfw',
      //   name: '社会化保障收入',
      //   uni: '(万元)',
      //   xData: ['青岛', '济南', '日照', '廊坊', '烟台', '青岛', '青岛', '济南', '日照', '廊坊', '烟台', '青岛', '青岛', '济南', '日照', '廊坊', '烟台', '青岛'],
      //   data: [323, 343, 656, 444, 333, 643,323, 343, 656, 444, 333, 643,323, 343, 656, 444, 333, 643]
      // }
      // echarts_zq.initEchart_singLine(params4)
      
      
      
    }
  },
  updated() {
     var self = this;
  },
  destroyed() { // 在组件生命周期结束的时候销毁。
    window.removeEventListener('message',this.gismapListener, true)
  }
}
</script>

<style lang='scss' scoped>
  @import url('../../comtable.scss');

  /deep/ .el-select .el-input__inner {
    height: 28px;
    // width: 100px;
    background: transparent;
    color: #1fe3ef;
    padding-right: 20px;
    padding-left: 10px;
    border-color: #3bc8d9;
  }
  .contentbody {
    height: 100%;
    background: url('~@/assets/images/bigScreen/bg-left.png') left no-repeat, url('~@/assets/images/bigScreen/bg-right.png') right no-repeat;
    background-size: auto 100%;
    margin: -30px 15px 10px 15px;
    position: relative;
    display: flex;
  }
 .leftbox,  .rightbox {
   width: 500px;
   height: 100%;
   box-sizing: border-box;
   padding: 15px;
   padding-bottom: 30px;
 }
 .centerbox {
   flex: 1;
   background: url('~@/assets/images/images_zy/centerborder.png') no-repeat ;
   background-size: 100% 100%;
   margin-top: 10px;
   margin-bottom: 80px;
   box-sizing: border-box;
   position: relative;
   padding: 100px 20px 20px 20px;
   position: relative;

 }
//  .item-title {
//    font-size: 22px;
//    color: aqua;
//    background: url('~@/assets/images/images_zy/itemtitle.png') no-repeat ;
//    background-size: 100% 100%;
//    line-height: 38px;
//     padding-left: 58px;
//     position: relative;
//  }
  .item-title {
   font-size: 18px;
   color: aqua;
   background: url('~@/assets/images/bigScreen/titlebg.png') no-repeat;
   background-size: 100% 100%;
   line-height: 46px;
   padding-left: 36px;
   margin-bottom: 5px;
   font-weight: bolder;
 }
 .chartbox {
   width: 100%;
   height: 100%;
 }

 .gdjkitem {
   height: 68px;
   width: 72px;
   margin: 0 auto;
   background: url('~@/assets/images/images_zy/cire.png') no-repeat;
  background-size: 100% 100%;
  line-height: 68px;
  font-size: 18px;
  text-align: center;
  font-weight: bolder;
  
 }

 .gdjkitembox {
   text-align: center;
   position: relative;
   margin-top: 12px;
   &:not(:last-child)::after{
     content: '';
     display: block;
     width: 18px;
     height: 18px;
     background: url('~@/assets/images/images_zy/jiantou.png') no-repeat;
     background-size: 100% 100%;
     position: absolute;
     right: -8px;
     top: 26px;
   }
 }


.mtheader {
  text-align: center;
    line-height: 40px;
    font-size: 16px;
    color: #51d1ee;
    border-bottom: 1px solid #308497;
}
.mtbody {
  height: 100%;
  margin: 6px 0;
  box-sizing: border-box;
  overflow: hidden;
}
.mtbody .scrollitem {
  text-align: center;
  height: 34px;
  line-height: 34px;
  padding: 0 5px;
}

.mtbody .scrollitem:nth-child(odd) {
  background: rgba(4,54,108,0.7);
}
 .centTab {
   position: absolute;
   z-index: 10;
   width: 100%;
   top: 30px;
   text-align: center;
  .centtabitem {
    display: inline-block;
    height: 56px;
    width: 140px;
    line-height: 66px;
    text-align: center;
    font-size: 18px;
    cursor: pointer;
    color: rgb(2, 252, 252);
     background: url('~@/assets/images/images_zy/WechatIMG431.png') no-repeat;
    background-size: 100% 120%;
    margin-right: -15px;
    opacity: 0.5;
    
   }
    .centtabitem.active {
       opacity: 1;
    }
 }
 .tunit {
   font-size: 16px;
 }


 .cardetailbox {
   display: flex;
   padding: 15px 0;
   .imgbox {
     margin-right: 30px;
     width: 380px;
     img {
       width: 380px;
       height: 250px; 
     }
   }
   .fontbox {
     color: #fff;
     font-size: 16px;
   }
 }
 /deep/.el-table tbody tr.rowclassname_00  td{
   color: rgb(243, 198, 101)!important;
 }
  /deep/.el-table tbody tr.rowclassname_01  td{
   color: rgb(92, 235, 74)!important;
 }
  /deep/.el-table tbody tr.rowclassname_02  td{
   color: rgb(86, 212, 243)!important;
 }

 .checkgroupbox {
   position: absolute;
   right: 10px;
   top: 0;
 }
 .checkgroupbox .el-checkbox {
   margin-right: 15px;
   .el-checkbox__label {
     margin-left: 6px;
   }
 }
  /deep/ .checkstate01 .el-checkbox__label {
     color: rgb(92, 235, 74)!important;
  }
   /deep/ .checkstate00 .el-checkbox__label {
     color: rgb(243, 198, 101)!important;
  }
  /deep/ .checkstate02 .el-checkbox__label {
    color: rgb(86, 212, 243)!important;
  }

  /deep/ #bzhdTable tbody tr {
    cursor: pointer !important;
  }

  .box-item {
  position: relative;
}
  .rowttabs {
   height: 40px;
  line-height: 40px;
  position: absolute;
  top: 0;
  right: 0;
  .rowttabs-item {
    padding: 4px 8px;
    border-radius: 5px;
    border: 1px solid #5b7bc9;
    margin-left: 10px;
    color: #698bdf;
    cursor: pointer;
  }
  .rowttabs-item.active {
    border: 1px solid #45d8e2;
     color: #45d8e2;
  }
 }
/deep/ .el-dialog {
  -webkit-transform: none;
  transform: none;
  left: 0;
  position: relative;
  z-index: 20000;
  margin: 0 auto;
  padding-bottom: 30px;
  background-image: url('~@/assets/images/bigScreen/kuang.png');
  background-size: 100% 100%;
  background-color: rgba(220, 38, 38, 0);
}

/deep/ .el-dialog__body {
  padding: 0px 20px;
}
/deep/ .el-dialog__headerbtn .el-dialog__close {
  color: #fff;
  font-size: 24px;
  font-weight: 500;
  margin: 2px 20px 0 0;
  border: 2px solid #193987;
  border-radius: 5px;
  background: #1e1e88;
}
 .dialogCon {
  padding: 0 40px;
  .dialogTitle {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding-right: 30px;
    .left {
      display: inline-block;
      padding-right: 110px;
      font-size: 24px;
      font-family: MFBanHei;
      font-weight: 400;
      color: #02f6ff;
      background-image: url('~@/assets/images/bigScreen/fullService/Rectangle 561.png');
      background-repeat: no-repeat;
      background-position: center right;
    }
    .title-right {
      color: #218cc8;
      font-size: 12px;
      font-family: Microsoft YaHei;
      div {
        width: 38px;
        height: 30px;
        line-height: 30px;
        text-align: center;
        display: inline-block;
        cursor: pointer;
        background-image: url('~@/assets/images/bigScreen/fullService/left-sub.png');
        background-repeat: no-repeat;
        background-size: 100% 100%;
      }
      .active {
        color: #02f6ff;
        background-image: url('~@/assets/images/bigScreen/fullService/left-subActive.png');
      }
    }
  }
}
.hddetali {
  padding: 10px;
  color: #fff;
  font-size: 14px;
  overflow: auto;
  height: 320px;
  h3 {
     color: #fff;
  }
}
.swiperClass {
  width: 80%;
  height: 280px;
  margin:  0 auto;
  .swiper-slide {
    img {
      width: 100%;
      height: 100%;
    }
  }
}

.swiper-pagination-bullet-active {
    opacity: 1;
    background: #19daec;
}
.swiper-pagination-bullet {
  opacity: 0.5;
  width: 12px;
  height: 12px;
}

.gistitle {
 position: absolute;
  left: 30px;
  top: 50px;
  font-size: 24px;
  color: aqua;

}
</style>

<style lang="css">
.initselect.el-select-dropdown {
    background: rgb(9,55,112) !important;
  }

.initselect .el-select-dropdown__item.hover, .el-select-dropdown__item:hover {
    background-color: #07234d;
}
.initselect .el-select-dropdown__item {
  color: #fff;
}
.initselect .el-select-dropdown__item.selected {
  color: aqua;
}
.initselect.el-select-dropdown {
  border: solid 1px #93b1f7;
}
.initselect .popper__arrow::after {
  border-bottom-color: #093770 !important;
}
</style>