<template>

  <div class="container">
    <!-- 页头 -->
    <Header>
      <template v-slot:smallTitle>
        <div class="header-smallTitle">渠道</div>
      </template>
    </Header>
    <!-- 内容 -->
    <FlexBox :list="bottomList" style="margin-top: -10px">
      <template slot>
        <div class="top-tabs">
          <el-radio-group v-model="radio">
            <el-radio-button :form="allData" label="全部" @click.native="clickMode('11')">全部</el-radio-button>
            <el-radio-button :form="yingye" label="营服营业厅" @click.native="clickMode('12')">营服营业厅</el-radio-button>
            <el-radio-button :form="intoyingye" label="营服下营业厅" @click.native="clickMode('13')">营服下营业厅</el-radio-button>
          </el-radio-group>
        </div>
        <!-- 左边 -->
        <div class="left">
          <charts id="test1" title="5G发展" :form="fiveGData" @click.native="clickMode('1')" :class="[selectMode === '1'?'backgroundImage3':'backgroundImage2' ]" style="height: 228px">
          </charts>
          <div style="margin-top: 10px" @click="clickMode('2')" :class="[selectMode === '2'?'backgroundImage4':'backgroundImage' ]" class="backgroundImage">
            <div style="margin-top: 10px;margin-left: 20px">
              <div style="display: block;height: 20px"></div>
              <span class="chartTitle">融合发展</span>
              <img src="../../../assets/images/bigScreen/fullService/Rectangle@2x.png" style="height: 14px;width: 60px;margin-left: 10px">
              <!--              <span  style="float: right;margin-right: 30px">更多></span>-->

            </div>
            <charts-right title="移宽融合" :form="togetherData" style="height: 198px"></charts-right>
            <div class="borderLine"></div>
            <charts-right title="移移融合主副卡" :form="mainAndNotMainData" style="height: 198px"></charts-right>
            <div class="borderLine"></div>
            <charts-right title="金融融合" :form="financeData" style="height: 198px"></charts-right>
          </div>
        </div>
        <!-- 中间 -->
        <div class="center">
          <!-- <div class="centerTop"></div> -->
          <el-row :gutter="20" style="height: 228px">
            <el-col :span="12">
              <charts id="test2" @click.native="clickMode('5')" :class="[selectMode === '5'?'backgroundImage3':'backgroundImage2' ]" :form="mobileData" title="移网发展" style="height: 228px"></charts>
            </el-col>
            <el-col :span="12">
              <charts id="test3" @click.native="clickMode('6')" :class="[selectMode === '6'?'backgroundImage3':'backgroundImage2' ]" :form="broadbandData" title="宽带发展" style="height: 228px"></charts>
            </el-col>
            <!--            <div class="map">-->
            <!--              <iframe ref="iframe" :src="iframeSrc" frameborder="0" style="width: 100%; height: 100%"></iframe>-->
            <!--            </div>-->
          </el-row>

          <div class="centerBottom">
            <div class="centerTop-title">
              <div class="titleLeft">{{mapData.label}}发展量</div>
              <div class="titleRight">
                <span class="margin" v-if="this.mapData.level < 4" @click="showDialog(2)">
                  详细数据 <img width="9px" height="13px" src="~@/assets/images/bigScreen/resource/dleft.png" />
                </span>
                <div class="rightDialogBg" v-if="selectDialogShow">
                  <span v-for="item in selectDialogList">item.name</span>
                </div>
              </div>
            </div>
            <div class="map">
              <iframe ref="iframe" :src="iframeSrc" frameborder="0" style="width: 100%; height: 100%"></iframe>
            </div>
          </div>
        </div>
        <!-- 右边 -->
        <div class="right">
          <charts id="test4" @click.native="clickMode('7')" :class="[selectMode === '7'?'backgroundImage3':'backgroundImage2' ]" style="height:228px;" :form="fiveGterminalData" title="5G终端销量"></charts>
          <charts @click.native="clickMode('8')" :class="[selectMode === '8'?'backgroundImage3':'backgroundImage2' ]" :form="AIData" style="height: 20vh;margin-top: 10px" title="智家业务发展"></charts>

          <charts-left class="backgroundImage2" :title-data="rightTitleAndData1" style="height: 213px;margin-top: 10px" @click.native="clickMode('9')" :class="[selectMode === '9'?'backgroundImage3':'backgroundImage2' ]" :form="rightTitleAndData1"></charts-left>
          <charts-left class="backgroundImage2" :title-data="rightTitleAndData2" style="height: 213px;margin-top: 10px" @click.native="clickMode('10')" :class="[selectMode === '10'?'backgroundImage3':'backgroundImage2' ]" :form="rightTitleAndData2"></charts-left>
        </div>
      </template>
    </FlexBox>
    <el-dialog title="装机工单" :visible.sync="dialogVisible" width="88%">
      <template slot="title">
        <div style="margin-top: 10px;margin-left: 20px;width: 100%">
          <span class="chartTitle2">营业厅全省{{title}}产品详情</span>
          <img src="../../../assets/images/bigScreen/fullService/Rectangle@2x.png" style="height: 14px;width: 86px;margin-left: 10px;margin-top: -3px">
        </div>
      </template>
      <business-hall-detail :detal-list-left="detalListLeft" :trend-data="trendData" @getDetail="changeTogether" :select-chanl-type-for-detai="selectChanlTypeForDetai" :data-list-right="detalListLeft2"></business-hall-detail>
    </el-dialog>
  </div>
</template>

<script>
import Header from '@/components/BigScreen/Header'
import FlexBox from '@/components/BigScreen/FlexBox'
import chartsRight from '@/views/channel/businessHall/components/chartsRight'
import chartsLeft from '@/views/channel/businessHall/components/chartsLeft'
import charts from './components/charts'
import { getChanelData, getChanelDetal, getChanelHallTrend, getChanelDetal2 } from '@/api/chanel.js'
import store from 'store'
import businessHallDetail from '@/views/channel/businessHall/components/businessHallDetail'
export default {
  components: {
    charts,
    Header,
    FlexBox,
    chartsRight,
    chartsLeft,
    businessHallDetail,
  },
  name: 'index',
  data() {
    return {
      dialogVisible: false,
      radio: '全部',
      //右侧弹出的select数组
      selectDialogList: [
        { name: '5G发展详情', type: 1 },
        { name: '移网发展详情', type: 2 },
        { name: '宽带发展详情', type: 3 },
        { name: '5G终端销量详情', type: 4 },
        { name: '智家发展详情', type: 5 },
        { name: '营销活动详情', type: 6 },
        { name: '两融发展详情', type: 7 },
        { name: '进厅详情', type: 8 },
        { name: '营销活动', type: 9 },
        { name: '进厅情况', type: 10 },
        { name: '全部', type: 11 },
        { name: '营服营业厅', type: 12 },
        { name: '营服下营业厅', type: 13 },
        // {name:'进到地市、区县、 营服时看详情数据',type:1},
      ],
      detalListLeft: [],
      selectDialogShow: false,
      //map地址
      iframeSrc: '',
      //选中的模块
      selectMode: '1',
      bottomList: [{
        name: '营业厅',
        url: '/channel/businessHall/index',
        active: true
      },
      {
        name: '渠道门店',
        url: '/channelShop/index',
      }, {
        name: '卖场',
        url: '/channel/sale/index',

      }, {
        name: '轻触点',
        url: '/channel/touchPoint/index',

      },
      {
        name: '小微商户',
        url: '/SmallBusinesses/index',

      },
      {
        name: '农村',
        url: '/rural/index',

      },
      ],
      rightTitleAndData1: {
        title: '营销活动',
        dateTitle: ['有效活动数', '覆盖用户', '接触用户'],
        chatName: '接触率',
        num: 17.9
      },
      rightTitleAndData2: {
        title: '进厅情况',
        dateTitle: ['进厅人数', '取号人数', '办理数'],
        chatName: '取号率',
        num: 88.9
      },
      //5g
      fiveGData: {},
      // 移网
      mobileData: {},
      //  宽带
      broadbandData: {},
      //  5G终端
      fiveGterminalData: {},
      //  智能管家
      AIData: {},
      // 融合
      togetherData: {},
      // 主副卡
      mainAndNotMainData: {},
      //  金融
      financeData: {},
      soreList: [10, 1, 99, 2, 82],
      timest: '',
      mapData: {},
      userInfo: {},
      params: {},
      allData: {},
      yingye: {},
      intoyingye: {},
      detalListLeft2: [],
      trendData: [],
      title: '5G发展',
      selectChanlTypeForDetai: '1'
    }
  },
  async mounted() {
    //获取时间
    this.timest = window.sessionStorage.getItem('selectTime')
    window.addEventListener('message', (e) => {
      this.mapDate = e.data
    })
    //初始化地图
    this.initParam()
  },
  watch: {
    // radio() {
    //   if(this.radio === "全部"){
    //     alert(this.radio)
    //   }else if(this.radio === "营服营业厅"){
    //     alert(this.radio)
    //   }else if(this.radio === "营服下营业厅"){
    //     alert(this.radio)
    //   }
    // },
  },
  methods: {
    initParam() {
      this.userInfo = store.get('userInfo');
      Object.assign(this.mapData, { label: store.get('userInfo').dataAreaName || '各地市' })

      if (store.get('userInfo').gridId) {
        this.mapData.level = 4;

      } else if (store.get('userInfo').areaCode) {
        this.mapData.level = 3;

      } else if (store.get('userInfo').eparchyCode && store.get('userInfo').eparchyCode != '0000') {
        this.mapData.level = 2;

      } else {
        this.mapData.level = 1;
      };

      // 默认参数
      this.param = {
        "timest": this.timest,
        "eparchyCode": this.userInfo.eparchyCode || '',
        "areaCode": this.userInfo.areaCode || '',
        "gridId": this.userInfo.gridId || '',
        "flag": "1",
        "chnlKindId": ""
      }
      this.init()
    },
    //初始化地图参数
    mapInit() {
      let that = this
      window.addEventListener('message', e => {
        that.mapData = e.data
        if (e.data.message == 'levelSwitch') {
          if (e.data.level == 1) {
            that.param.eparchyCode = '0000'
            that.param.areaCode = ''
            that.param.gridId = ''
            that.param.mLevel = '1'
          } else if (e.data.level == 2) {
            that.param.eparchyCode = e.data.area_id
            that.param.areaCode = ''
            that.param.gridId = ''
            that.param.mLevel = '2'
          } else if (e.data.level == 3) {
            // that.param.eparchyCode = ''
            that.param.areaCode = e.data.area_id
            that.param.gridId = ''
            that.param.mLevel = '3'
          } else if (e.data.level == 4) {
            // that.param.eparchyCode = ''
            // that.param.areaCode = ''
            that.param.gridId = e.data.area_id
            that.param.mLevel = '4'
          }
          that.param.timest = that.timest
          that.init()
        }
      })
    },

    showDialog(item) {
      this.dialogVisible = true
      this.getChanelDetalM()
      this.getChanelDetalM2()
      this.getChanelHallTrendM()
    },
    //初始化参数
    async init() {
      this.changgeParams('1')
      let level = this.mapData.level
      let eparchyCode = this.userInfo.eparchyCode
      let areaCode = this.userInfo.areaCode
      let gridId = this.userInfo.gridId
      let timest = this.timest
      let se_type = this.params.se_type
      let yyt_type = this.params.yyt_type
      let type = this.params.type
      this.iframeSrc = `http://134.32.115.253:18080/sdresview/?type=${type}&yyt_type=${yyt_type}&se_type=${se_type}&level=${level}&sceneid=3&gis_sceneid=6&area_id=${gridId || areaCode || eparchyCode}&poi_city_id=370100&timest=${timest}`
      // this.fiveGData = await this.getchanelDataMethods('1')
      // this.mobileData = await this.getchanelDataMethods('2')
      // this.broadbandData = await this.getchanelDataMethods('3')
      // this.fiveGterminalData = await this.getchanelDataMethods('4')
      // this.AIData = await this.getchanelDataMethods('8')
      // this.togetherData = await this.getchanelDataMethods('5')
      // this.mainAndNotMainData = await this.getchanelDataMethods('6')
      // this.financeData = await this.getchanelDataMethods('7')
    },
    changgeParams(type) {
      this.selectMode = type
      this.params.type = "04";
      if (type === '1') {
        this.params.se_type = "XUK0003";
        this.selectChanlTypeForDetai = '1'
        this.title = '5G发展'
      } else if (type === '2') {
        this.params.se_type = "XUK0001";
        this.title = '融合发展'
        this.selectChanlTypeForDetai = '6'
      } else if (type === '3') {
        this.params.se_type = "XUK0002";
        this.title = '5G发展'
      } else if (type === '4') {
        this.params.se_type = "XUK0007";
        this.title = '5G发展'
      } else if (type === '5') {
        this.params.se_type = "XUK0004";
        this.title = '移网发展'
        this.selectChanlTypeForDetai = '2'
      } else if (type === '6') {
        this.params.se_type = "XUK0005";
        this.title = '宽带发展'
        this.selectChanlTypeForDetai = '3'
      } else if (type === '7') {
        this.params.se_type = "XUK0006";
        this.title = '5G终端销量'
        this.selectChanlTypeForDetai = '4'
      } else if (type === '8') {
        this.params.se_type = "XUK0008";
        this.title = '智家业务发展'
        this.selectChanlTypeForDetai = '5'
      } else if (type === '9') {
        this.params.se_type = "XUK0009";
        this.title = '营销活动'
        this.selectChanlTypeForDetai = '9'
      } else if (type === '10') {
        this.params.se_type = "XUK0010";
        this.title = '进厅情况'
        this.selectChanlTypeForDetai = '10'
      } else if (type === '11') {
        this.params.se_type = "";
        this.params.yyt_type = "0401";
        this.title = '全部'
        this.selectChanlTypeForDetai = '11'
      } else if (type === '12') {
        this.params.se_type = "";
        this.params.yyt_type = "0402";
        this.title = '营服营业厅'
        this.selectChanlTypeForDetai = '12'
      }else if (type === '13') {
        this.params.se_type = "";
        this.params.yyt_type = "0403";
        this.title = '营服营业厅'
        this.selectChanlTypeForDetai = '13'
      }
      this.params.message = "changeType";
    },
    //点击相关模块
    clickMode(type) {
      this.changgeParams(type)
      let eparchyCode = this.userInfo.eparchyCode
      let areaCode = this.userInfo.areaCode
      let gridId = this.userInfo.gridId
      let map = {
        eparchyCode: this.userInfo.eparchyCode,
        areaCode: this.userInfo.areaCode,
        gridId: this.userInfo.gridId,
        timest: this.timest,
        se_type: this.params.se_type,
        type: this.params.type,
        level: this.mapData.level,
        area_id: eparchyCode || areaCode || gridId,
        sceneid: '3',
        gis_sceneid: '6',
        poi_city_id: '370100',
        changeType: '',
        yyt_type: this.params.yyt_type
      }
      map.message = "changeType";
      console.log(map)

      window.frames[0].postMessage(map, "*");
      this.$forceUpdate()
    },

    changeTogether(type) {
      this.selectChanlTypeForDetai = type
      this.getChanelDetalM()
    },
    getChanelDetalM() {
      let paramD = {}
      paramD = this.param
      paramD.chnlType = this.selectChanlTypeForDetai
      paramD.chnlKindTypeCode = '02'
      paramD.mLevel = '1'
      // paramD = this.params
      paramD.eparchyCode = ''
      getChanelDetal(paramD).then(res => {
        if (res) {
          this.detalListLeft = res.result.data
        }
      }).catch(() => {
      })
    },
    getChanelHallTrendM() {
      let paramD = {}
      paramD = this.param
      paramD.chnlType = this.selectMode
      paramD.chnlKindTypeCode = '02'
      paramD.mLevel = '1'
      // paramD = this.params
      paramD.eparchyCode = ''
      getChanelHallTrend(paramD).then(res => {
        if (res) {
          this.trendData = res.result.data
        }
      }).catch(() => {
      })
    },

    getChanelDetalM2(type) {
      let paramD = {}
      paramD = this.param
      paramD.chnlType = this.selectMode
      paramD.chnlKindTypeCode = '02'
      paramD.mLevel = '1'
      // paramD = this.params
      paramD.eparchyCode = ''
      paramD.type = type
      getChanelDetal2(paramD).then(res => {
        if (res) {
          this.detalListLeft2 = res.result.data
        }
      }).catch(() => {
      })
    },
    //获取时间
    async getDate(date) {
      this.timest = date
      this.userInfo = store.get('userInfo');
      // alert(JSON.stringify( this.userInfo))
      // 默认参数
      this.param = {
        "timest": this.timest,
        "eparchyCode": this.userInfo.eparchyCode || '',
        "areaCode": this.userInfo.areaCode || '',
        "gridId": this.userInfo.gridId || '',
        "mLevel": this.mapData.level || '',
        "flag": "1",
        "chnlKindId": ""
      }
      // this.params.se_type = "XUK0003";
      this.params.message = "changeType";
      this.fiveGData = await this.getchanelDataMethods('1')
      this.mobileData = await this.getchanelDataMethods('2')
      this.broadbandData = await this.getchanelDataMethods('3')
      this.fiveGterminalData = await this.getchanelDataMethods('4')
      this.AIData = await this.getchanelDataMethods('8')

      this.togetherData = await this.getchanelDataMethods('5')
      this.mainAndNotMainData = await this.getchanelDataMethods('6')
      this.financeData = await this.getchanelDataMethods('7')
      this.rightTitleAndData1 = await this.getchanelDataMethods('9')
      this.rightTitleAndData2 = await this.getchanelDataMethods('10')
      this.allData = await this.getchanelDataMethods('11')
      this.yingye = await this.getchanelDataMethods('12')
      this.intoyingye = await this.getchanelDataMethods('13')
      window.frames[0].postMessage(this.params, "*");
      this.$forceUpdate()
    },
    //获取数据
    async getchanelDataMethods(type) {
      this.param.flag = type
      try {
        let res = await getChanelData(this.param);
        return res?.result?.tblList[0];
      } catch (e) {
        // this.requestFailed(err);
        return null;
      }
    }
  },
  destroyed() { // 在组件生命周期结束的时候销毁。
    window.removeEventListener('message', this.mapInit, true)
  }
}
</script>

<style lang="less" scoped>
/deep/ .bottom {
  width: 40% !important;
  left: 30% !important;
}
.container {
  position: relative;
  display: flex;
  flex-direction: column;
  overflow: auto;
  width: 100%;
  height: 100%;
  color: #fff;
  background: #01153b;
  // background-image: image-set(
  //     url("~@/assets/images/bigScreen/bg.jpg") 1x,
  //     url("~@/assets/images/bigScreen/bg@2x.jpg") 2x
  // );
  // background-repeat: no-repeat;
  // background-size: 100% 100%;
  overflow: hidden;
  .header-smallTitle {
    font-size: 36px;
    font-family: MFBanHei;
    font-weight: 400;
    color: #ffffff;
    margin-top: -7px;
  }
}
.top-tabs {
  position: absolute;
  top: -2.7rem;
  left: 0rem;
}
.content {
  .left {
    width: 23%;
  }
  .center {
    flex: 1;
    margin: 0 20px;
    .centerTop {
      width: 100%;
      height: 245px;
      background-image: image-set(
        url('~@/assets/images/bigScreen/fullService/center-top.png') 1x,
        url('~@/assets/images/bigScreen/fullService/center-top@2x.png') 2x
      );
      background-repeat: no-repeat;
      background-size: 100% 100%;
    }
  }
  .right {
    width: 23%;
  }
  .backgroundImage {
    background-image: url('../../../assets/images/bigScreen/fullService/chanel_bus_left_title_bg@2x.png');
    background-size: 100% 100%;
  }
  .backgroundImage2 {
    background-image: url('../../../assets/images/bigScreen/fullService/chanel_business_bg@2x.png');
    background-size: 100% 100%;
  }
  .backgroundImage3 {
    background-image: url('../../../assets/images/bigScreen/fullService/chanle_select_bg.png');
    background-size: 100% 100%;
  }
  .backgroundImage4 {
    background-image: url('../../../assets/images/bigScreen/fullService/chnlBgSelec.png');
    background-size: 100% 100%;
  }

  .borderLine {
    width: 80%;
    margin-left: 10%;
    margin-top: 2px;
    height: 1px;
    border: 1px dashed #009bff;
    border-image: -webkit-linear-gradient(#009bff, #16e4cf) 30 30;
    border-image: -moz-linear-gradient(#009bff, #16e4cf) 30 30;
    border-image: linear-gradient(#009bff, #16e4cf) 30 30;
  }
  .chartTitle {
    margin-top: 10px;
    margin-left: 10px;
    font-family: 'MFBanHei';
    color: #02f6ff;
  }
}
.map_bg {
  background-image: url('../../../assets/images/bigScreen/fullService/map_bg.png');
  background-size: 100% 100%;
  padding: 10px 30px 30px;
  height: 69%;
  margin-top: 10px;
  //height: 917.5px;
}
.map {
  padding: 10px 30px 30px;
  height: 90%;
}
.centerTop-title {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 10px 30px 0 40px;
  .titleLeft {
    padding-right: 110px;
    font-size: 24px;
    font-family: MFBanHei;
    font-weight: 400;
    color: #02f6ff;
    background-image: image-set(
      url('~@/assets/images/bigScreen/fullService/Rectangle 561.png') 1x,
      url('~@/assets/images/bigScreen/fullService/Rectangle@2x.png') 2x
    );
    background-repeat: no-repeat;
    background-position: center right;
  }
  .titleRight {
    font-size: 14px;
    font-family: Microsoft YaHei;
    font-weight: 400;
    color: #a5e8fe;
    cursor: pointer;
  }
}
.centerBottom {
  width: 100%;
  height: 631px;
  margin-top: 20px;
  background-image: image-set(
    url('~@/assets/images/bigScreen/fullService/mapBg.png') 1x,
    url('~@/assets/images/bigScreen/fullService/mapBg@2x.png') 2x
  );
  background-repeat: no-repeat;
  background-size: 100% 100%;
  .centerTop-title {
    padding-top: 30px;
  }
  .margin {
    margin-right: 20px;
  }
  .map {
    padding: 10px 30px 30px;
    height: 90%;
  }
}
.rightDialogBg {
}
/deep/ .el-dialog {
  -webkit-transform: none;
  transform: none;
  left: 0;
  position: relative;
  margin: 0 auto;
  background-image: url('~@/assets/images/bigScreen/kuang.png');
  background-size: 100% 100%;
  height: 760px;
  background-color: rgba(220, 38, 38, 0);
}
.chartTitle2 {
  margin-top: 10px;
  margin-left: 10px;
  font-family: 'MFBanHei';
  color: #02f6ff;
  font-size: 24px;
}
/deep/ .el-dialog__headerbtn .el-dialog__close {
  color: #fff;
  font-size: 24px;
  font-weight: 500;
  margin: 10px 30px 0 0;
  border: 2px solid #193987;
  border-radius: 5px;
  background: #1e1e88;
}
/deep/ .el-dialog__body {
  padding: 0px 20px;
}
/deep/.el-radio-button {
  margin-right: 15px;
}
/deep/.el-radio-button__inner {
  background: none !important;
  border-color: #1890ff !important;
  -webkit-box-shadow: -1px 0 0 0 #1890ff !important;
  box-shadow: -1px 0 0 0 #1890ff !important;
  color: #1890ff;
}
</style>
