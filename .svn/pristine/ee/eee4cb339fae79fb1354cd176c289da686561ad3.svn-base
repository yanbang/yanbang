<!-- 政企 交付保障 -->
<template>
  <div class = "contentbox">
     <Header v-if = "or_he == '0'" explaincode = "fu_gongdna"   backurl =  "/unicomwisdomeyes/yhzl_index"  title="山东联通网络智慧眼-沿黄战略" subtitle="工单交付"></Header>
     <Header  v-else explaincode = "fu_gongdna" title = "山东联通网络智慧眼-服" subtitle = "交付"></Header>
    <div class = "contentbody">
      <div class = "leftbox flex colflex">
        <div class = "box-item flex colflex" style="height: 160px">
           <div class = "item-title titlefont">
             <span>在途工单监控</span>
           </div>
            <div class = "flex1 flex">
              <div class = "flex1 gdjkitembox" v-for = "(n, index) in ztgdjkData" :key="index" @click="ztgdDetalFn(n)">
                <div class = "gdjkitem">
                  <span class="numfont">{{n.value || '-'}}</span> 
                </div>
                <div class = "gdjkitem-font">{{n.name}}</div>
              </div>
            </div>
        </div>

        <div class = "box-item flex colflex flex1">
           <div class = "item-title titlefont">
             <span>当天交付率</span>
           </div>

           <div  class = "flex1">
             <div class="chartbox" id = "chart_dtjf"></div>
           </div>
        </div>

        <div class = "box-item flex colflex flex1">
           <div class = "item-title titlefont">
             <span>当月交付率</span>
           </div>

            <div  class = "flex1">
             <div class="chartbox" id = "chart_dyjf"></div>
           </div>
        </div>


        <div class = "box-item flex colflex flex1">
           <div class = "item-title titlefont">
             <span>异常工单</span>
           </div>
            <div  class = "flex1">
              <div class="chartbox" id = "chart_ycgd"></div>
            </div>
        </div>
      </div>
      <div class = "centerbox flex colflex">
        <div class="tjbtn"  @click="isDialogShow_ZHY=true" ><img src="../../zhyeys.png" alt="" srcset=""></div>
         <div class="centTab">
            <div class="centtabitem titlefont" :class="{'active': tabstatus == '3'}" @click="tabStatusFn('3')">
              <span>点到网</span>
            </div>
            <div class="centtabitem titlefont" :class="{'active': tabstatus == '5'}" @click="tabStatusFn('5')">
              <span>点到点</span>
            </div>
          </div>
            <div class="gistitle">
              <span class="titlefont">{{gisTitle}}</span>
            </div>
        <iframe  ref="gisiframe" id="gisiframe" :src="iframeSrc"  style="widh: 100%; height: 100%" frameborder="0"></iframe>
      </div>
      <div class = "rightbox flex colflex">

         <div class = "box-item flex colflex flex1">
           <div class = "item-title titlefont">
             <span>当天在途故障工单</span>
           </div>

           <div  class = "flex1">
             <div class="chartbox" id = "chart_rztgzgd"></div>
           </div>
         </div>
         <div class = "box-item flex colflex flex1">
           <div class = "item-title titlefont">
             <span>当月完成故障工单</span>
           </div>

           <div  class = "flex1">
             <div class="chartbox" id = "chart_rwcgzgd"></div>
           </div>
         </div>
         <div class = "box-item flex colflex" style="height: 296px">
           <div class = "item-title titlefont">
             <span>重点业务保障</span>
             <span v-show="mapLevel > 1" style="margin-left: 10px">(全省)</span>
             <span class="pull-right morebtn" @click="moreDetail"><span class="el-icon-more"></span></span>
           </div>
           <div class="flex mtheader">
             <div class=" tcolum titlefont"  style="width: 180px;">客户名称</div>
             <!-- <div class="flex1 tcolum titlefont">级别</div> -->
             <div class="flex1 tcolum titlefont">开始时间</div>
             <div class="flex1 tcolum titlefont">结束时间</div>
             <!-- <div class="flex1 tcolum titlefont">电路数</div> -->
           </div>
           <div  class = "flex1 flex colflex mtbody">
              <vue-seamless-scroll ref="seamlessScroll" :data="listData" :class-option="classOption" class="warp" v-show="listData.length > 0">
                  <div class="scrollitem flex" v-for="(item, index) in listData" :key="index">
                      <div class=" tcolum ellipsis" style="width: 180px; text-align: left" :title="item.cust_name">{{item.cust_name}}</div>
                      <!-- <div class="flex1 tcolum">{{item.order_level}}</div> -->
                      <div class="flex1 tcolum">{{item.start_time}}</div>
                      <div class="flex1 tcolum">{{item.end_time}}</div>
                      <!-- <div class="flex1 tcolum">{{item.Dianlu_nums}}</div> -->
                  </div>
                </vue-seamless-scroll>

                <div class="emptybox" v-show="listData.length == 0">
                   <div class="exmptfont">暂无业务保障活动</div>
                   <div class="scrollitem flex" v-for="(item, index) in 8" :key="index">
                  </div>
                </div>
           </div>
         </div>

      </div>


       <!-- 全省5G发展明细 -->
     <el-dialog :visible.sync="isDialogShow" width="68%" :modal-append-to-body='false'>
        <div class="dialogCon">
          <div class="dialogTitle">
            <div class="left">重点业务保障明细</div>
          </div>
          <div class="dialogTableBg">
            <el-table :data="listData"  style="width: 100%; height:620px;overflow: auto;">
              <el-table-column prop="title" label="工单标题" width="260px" align="left"> </el-table-column>
              <el-table-column prop="cust_name" label="客户名称"  align="left" width="260px"> </el-table-column>
              <el-table-column prop="order_level" label="级别"> </el-table-column>
              <el-table-column prop="start_time" label="开始时间"> </el-table-column>
              <el-table-column prop="end_time" label="结束时间" ></el-table-column>
              <el-table-column prop="Dianlu_nums" label="电路数"> </el-table-column>
            </el-table>
          </div>
        </div>
      </el-dialog>


       <el-dialog :visible.sync="isDialogShow2" width="82%" :modal-append-to-body='false'>
        <div class="dialogCon">
          <div class="dialogTitle">
            <div class="left">在途工单监控-{{currztgdTite}}</div>
          </div>
          <div class="dialogTableBg">
            <el-table :data="ztgdlistData" class="inittable2"  style="width: 100%;overflow: auto;" height = "600px" v-loading = "vztgdLoading">
              <el-table-column prop="city_name" label="地市" width= '100'> </el-table-column>
              <el-table-column prop="sub_name" label="区县"  width= '120'> </el-table-column>
              <el-table-column prop="order_id" label="订单编码"> </el-table-column>
<!--
              <el-table-column prop="order_cd" label="建设工单编码"> </el-table-column>
-->
              <el-table-column prop="huanjie_name_old" label="环节名称"> </el-table-column>
              <el-table-column prop="huanjie_starttime" label="环节开始时间"> </el-table-column>
              <!-- <el-table-column prop="huanjie_endtime" label="环节结束时间"> </el-table-column> -->
              <el-table-column prop="deal_user_name" label="环节办理人" ></el-table-column>
              <el-table-column prop="deal_user_phone" label="办理人电话"> </el-table-column>
              <el-table-column prop="" label="工单流程">
                  <template slot-scope="scope">
                    <el-button class="linkbtn" type="text" size="small">
                      <a :href = "scope.row.link_href"   target="_blank"> 详情</a>
                    </el-button>
                  </template>
               </el-table-column>
            </el-table>
          </div>
        </div>
      </el-dialog>


        <el-dialog :visible.sync="isDialogShow3" width="68%" :modal-append-to-body='false'>
        <div class="dialogCon">
          <div class="dialogTitle">
            <div class="left">异常工单</div>
          </div>
          <div class="dialogTableBg">
            <el-table :data="ycgdlistData"  style="width: 100%; height:620px;overflow: auto;">
              <el-table-column prop="city_name" label="地市" width= '100'> </el-table-column>
              <el-table-column prop="sub_name" label="区县"  width= '120'> </el-table-column>
              <el-table-column prop="huanjie_name_old" label="环节具体名称" > </el-table-column>
              <el-table-column prop="huanjie_starttime" label="环节开始时间"> </el-table-column>
               <el-table-column prop="deal_user_name" label="环节办理人" ></el-table-column>
              <el-table-column prop="deal_user_phone" label="办理人电话"> </el-table-column>
            </el-table>
          </div>
        </div>
      </el-dialog>


      
     <el-dialog :visible.sync="isDialogShow_ZHY" width="50%" :modal-append-to-body='false'>
        <div class="dialogCon">
          <div class="dialogTitle">
            <div class="left">网络智慧眼</div>
          </div>
          <div class="dialogTableBg">
             <div style="min-height: 280px; position: relative;">
               <div class="tjtitle">
                 {{gisTitle}}分析
               </div>
             
               <div class = "tjbody" style="margin-top: 10px; margin-left: 10px; margin-bottom: 50px">
            
                 <div class="tjitem">
                  <p>当月{{gisTitle}}点到网专线交付时长最短地区为<span class="bcolor">{{zhyData.name1}}</span>, 平均交付时长<span class="bcolor">{{zhyData.value1}}工作日</span>。</p>
                  <p>当月{{gisTitle}}点到点专线交付时长最短地区为<span class="bcolor">{{zhyData.name2}}</span>, 平均交付时长<span class="bcolor">{{zhyData.value2}}工作日</span>。</p>
                 <p>当月{{gisTitle}}专线故障处理时长最短地区为<span class="bcolor">{{zhyData.name3}}</span>, 平均处理时长<span class="bcolor">{{zhyData.value3}}分钟</span>。</p>
                 </div> 
               </div>
               
             </div>
          </div>
        </div>
    </el-dialog>




    </div>

    <!-- <Footer :tabdata = "tabdata"></Footer> -->
  </div>
</template>

<script>
import Header from '@/components/resource_visual/header2';
import Footer from '@/components/resource_visual/footer';
import echarts_zq from '@/views/resource_visual/echarts_component/echarts_zq';
import vueSeamlessScroll from 'vue-seamless-scroll'
import store from 'store'
import { mapState } from 'vuex'
import  serviceApi from '@/api/tactics'
var _ = require('@/utils/lodash.js')
var Qs = require('@/utils/qs.js')
import axios from 'axios'
export default {
  data () {
    return {
      or_he: '1',
      zhyData:{
        name1: '',
        name2: '',
        name3: '',
        value1: '',
        value2: '',
        value3: ''
      },
      isDialogShow_ZHY: false,
      ztgdlistData: [],
      currztgdTite:'',
       gisTitle: '山东省',
      isDialogShow: false,
      isDialogShow2: false,
      cityCode: '370000',
      tabstatus: '3',
      tabdata: [
        {title: '智慧营销',active: false, href: '/resource_visual/zhengqi_zhyx' },
        {title: '交付保障', active: true, href: '/resource_visual/zhengqi_jfbz'},
        {title: '客户保障', active: false, href: '/resource_visual/zhengqi_khbz'}
      ],
      listData: [],
      classOption: {
        singleHeight: 34,
        limitMoveNum: 7,
         waitTime: 2000 
      },

      iframeSrc: '',
      gisQueryParams: {},
      queryParams: {},
      gisMapData: {},
      mapLevel: 1,
      areaCode: '',
      jfbzAllData: [],
      ztgdAllData: {},
      ztgdjkData: [],
      vztgdLoading: false,
      isDialogShow3: false,
      ycgdlistData: [],
      averageData: {},
      control: [],
      initgisTitle: '',
    }
  },
  components: {
    Header,
    Footer,
    vueSeamlessScroll
  },
  created () {
      if (this.$route.query.pagesource && this.$route.query.pagesource == 'yhzl') {
        this.or_he = '0'
      } else {
        this.or_he = '1'
      }
  },
  mounted () {
      var self = this;
      var initArea_id = '370000'
      this.mapLevel = 1;
      if (store.get('userInfo')) {
        var userInfo =  store.get('userInfo')
        var mapLevel = userInfo.levelAreaLevel;
        // 分权分域
        if (mapLevel == '1') {
          // 全省
          initArea_id = '370000'
          self.gisTitle = '山东省'
          self.mapLevel = '1'
          self.control = ['370000']
        } else if (mapLevel == '2') {
          // 地市
          initArea_id = '370000'
          self.gisTitle = '山东省'
          self.mapLevel = '1'
          self.control = ['370000', userInfo.levelAreaCode]
        } else if (mapLevel >= '3') {
          // 区县
          initArea_id = userInfo.levelAreaCode
          self.mapLevel = '2'
          self.gisTitle = userInfo.levelAreaName
          self.control = ['370000', userInfo.levelAreaCode, userInfo.levelCityCode]
        } 
      }
     this.cityCode = initArea_id;
     this.initGisMap(initArea_id);
    this.initgisTitle = this.gisTitle + '';

     // 注册地图事件
    window.addEventListener('message',self.gismapListener, true);


    this.initService()
  },
  watch: {},
  computed: {
    ...mapState({
       searchDate: state => state.resource.searchDate,
    }),
  },
  methods: {
    openDetaliPage (row) {
    
    },
    ztgdDetalFn (item) {
      this.currztgdTite = item.name
      this.isDialogShow2 = true;
      this.serviceZqZtgdmx(item.name)  
    },
    serviceZqZtgdmx (name) {
      var typeCode = _.cloneDeep(this.mapLevel)
      if (typeCode >= 3) {
        typeCode = 3
      }
      
      var params = {
         "huanjie_name": name,
         "order_flag": this.tabstatus == '3'? "3日通" : "5日通",
         "typeCode": typeCode, // 1：查询省、2：查询市、3：查询县
         "cityCode": this.cityCode,
          or_he: this.or_he,
      };
      this.vztgdLoading = true
       this.ztgdlistData = []
      serviceApi.serviceZqZtgdmx(params).then(res => {
       this.vztgdLoading = false
        if (res.rspCode == '0000') {
           if (params.huanjie_name == '建设环节' || params.huanjie_name == '需求决策') {
             res.result.data.forEach(item => {
              item.link_href = "http://134.33.24.150:8180/sso/ssoLogin?sourceSystemId=RSVSYS&sourceSystemToken=C36081CEE6603BCBE0556E92BF6928E8&urlid=12&userLoginName=UnN2LXNzb2FjY291bnQ=&remandCode=" + item.order_cd;
             })
           } else {
             res.result.data.forEach(item => {
               item.link_href = "http://134.32.115.204:8180/resources/orderDetailProcessInfo1.jsp?orderCode="+ item.order_code + "&logo=RM";
             });
           }
           this.ztgdlistData = res.result.data
         } else {
           this.$message.error(res.rspMsg)
        }
      })
    },
    moreDetail () {
      this.isDialogShow = true
    },
    initService () {
      this.jfbzList()
      this.ywbzList()
      this.zqZjgd()
    },
    zqZjgd () {
      var params = {
        or_he: this.or_he,
         "cityCode": this.cityCode
      };
      serviceApi.zqZjgd(params).then(res => {
        if (res.rspCode == '0000') {
          this.ztgdAllData =  res.result.data[0] || {}
          this.renderZtgd()
         } else {
           this.$message.error(res.rspMsg)
        }
      })
    },
    renderZtgd () {
      var ztgdData =  this.ztgdAllData;
      var tabstatus = this.tabstatus;
      if (tabstatus == 3) {
        this.ztgdjkData = [
          {'name': '工单审核', value: ztgdData['work_order_review3']},
          {'name': '需求决策', value: ztgdData['demand_decision3']},
          {'name': '建设环节', value: ztgdData['construction_link3']},
          {'name': '资源配置', value: ztgdData['resource_allocation3']},
          {'name': '数据配置', value: ztgdData['data_configuration3']},
          {'name': '施工调测', value: ztgdData['construction_survey3']},
        ]
      } else if (tabstatus == 5) {
        this.ztgdjkData = [
          {'name': '工单审核', value: ztgdData['work_order_review5']},
          {'name': '需求决策', value: ztgdData['demand_decision5']},
          {'name': '建设环节', value: ztgdData['construction_link5']},
          {'name': '资源配置', value: ztgdData['resource_allocation5']},
          {'name': '数据配置', value: ztgdData['data_configuration5']},
          {'name': '施工调测', value: ztgdData['construction_survey5']},
        ]
      }
    },
    ycgdDetal (params) {
      
      var typeCode = ''
      if (params.seriesName == '在途超长工单') {
        typeCode = '1'
      } else if  (params.seriesName == '挂起工单') {
        typeCode = '3'
      } else if (params.seriesName == '系统异常工单') {
        typeCode = '2'
      }
      var jfbzAllData = this.jfbzAllData;
      var cityCode = jfbzAllData.filter(item => {
        return item.name ==  params.name
      })[0].code;
      var params = {
        or_he: this.or_he,
         "order_flag": this.tabstatus == '3'? "3日通" : "5日通",
         "typeCode": typeCode, // 1：查询省、2：查询市、3：查询县
         "cityCode": cityCode
      }
      this.isDialogShow3 = true;
      this.ycgdlistData = []
      
      serviceApi.serviceZqZtqcgd(params).then(res => {
        if (res.rspCode == '0000') {
          this.ycgdlistData =  res.result.data || []
         } else {
           this.$message.error(res.rspMsg)
         }
      })
      
    },
    orderDataFn (datas, key) {
      return  _.orderBy(datas, function (item) {
          return Number(item[key])  || 0;
      }, ['desc']);
    },
    initEchartFn () {
       var self = this;
      function clickCallback(params) {
        // 点击图形回调函数
        self.ycgdDetal(params)
      }
      var tabstatus = this.tabstatus;
      var jfbzAllData = this.jfbzAllData;
      var Xdata = jfbzAllData.map(item => {
        return item.name;
      })
      if (tabstatus == 3) {
        // 当天交付率
        let params1_data = this.orderDataFn(jfbzAllData, 'three_day_avg_length');
        var params1 = {
            domId: 'chart_dtjf',
            legend: ['工单数量', '平均处理时长'],
                zoomVal: 100,
            xData: params1_data.map(item => {
              return item.name;
            }),
            unit: '(工作日)',
            // bar_markname: '工单数量',
            bar_markLine: this.averageData.three_day_nums,
            // line_markname: '平均处理时长',
            line_markLine: this.averageData.three_day_avg_length,
            barData: params1_data.map(item => {
              return Number(item.three_day_nums) || 0;
            }),
            lineData: params1_data.map(item => {
              return Number(item.three_day_avg_length) || 0;
            })
        };
        echarts_zq.initEchart_barLine(params1);


       // 当月交付率
        
     
        let params2_data = this.orderDataFn(jfbzAllData, 'three_mon_avg_length');

        var params2 = {
          domId: 'chart_dyjf',
              zoomVal: 100,
          legend: ['工单数量', '平均处理时长'],
          xData: params2_data.map(item => {
              return item.name;
            }),
          unit: '(工作日)',
          // bar_markname: '工单数量',
          bar_markLine: this.averageData.three_mon_nums,
          // line_markname: '平均处理时长',
          line_markLine: this.averageData.three_mon_avg_length,
          barData: params2_data.map(item => {
              return Number(item.three_mon_nums) || 0;
            }),
            lineData: params2_data.map(item => {
              return Number(item.three_mon_avg_length) || 0;
          })
        }
        echarts_zq.initEchart_barLine(params2)

       // 异常工单
        let params3_data = this.orderDataFn(jfbzAllData, 'three_day_on_ways');
        var params3 = {
          domId: 'chart_ycgd',
              zoomVal: 100,
          legend: ['在途超长工单', '挂起工单', '系统异常工单'],
          xData:  params3_data.map(item => {
              return item.name;
          }),
          line_markLine: this.averageData.three_day_on_ways,
          line_markLine2: this.averageData.three_hand_ups,
          line_markLine3: this.averageData.three_except_order,
          lineData1: params3_data.map(item => {
              return Number(item.three_day_on_ways) || 0;
          }),
          lineData2: params3_data.map(item => {
              return Number(item.three_hand_ups) || 0;
          }),
          lineData3:  params3_data.map(item => {
              return Number(item.three_except_order) || 0;
          }),
       }
       echarts_zq.initEchart_lines(params3, clickCallback)
      } else if (tabstatus == 5) {
         // 当天交付率
        let params1_data5 = this.orderDataFn(jfbzAllData, 'three_day_avg_length');
        var params1 = {
            domId: 'chart_dtjf',
            unit: '(工作日)',
                zoomVal: 100,
            legend: ['工单数量', '平均处理时长'],
            xData:  params1_data5.map(item => {
              return item.name;
            }),
            bar_markLine: this.averageData.five_day_nums,
            line_markLine: this.averageData.five_day_avg_length,
            barData: params1_data5.map(item => {
              return Number(item.five_day_nums) || 0;
            }),
            lineData: params1_data5.map(item => {
              return Number(item.five_day_avg_length) ||  0;
            })
        }
        echarts_zq.initEchart_barLine(params1);


        // 当月交付率
        let params2_data5 = this.orderDataFn(jfbzAllData, 'five_mon_avg_length');
        var params2 = {
          domId: 'chart_dyjf',
          unit: '(工作日)',
              zoomVal: 100,
          legend: ['工单数量', '平均处理时长'],
          xData: params2_data5.map(item => {
              return item.name;
          }),
           bar_markLine: this.averageData.five_mon_nums,
          line_markLine: this.averageData.five_mon_avg_length,
          barData: params2_data5.map(item => {
              return Number(item.five_mon_nums) || 0;
            }),
          lineData: params2_data5.map(item => {
              return Number(item.five_mon_avg_length) || 0;
          })
        }
        echarts_zq.initEchart_barLine(params2);


        // 异常工单
        let params3_data5 = this.orderDataFn(jfbzAllData, 'five_day_on_ways');
        var params3 = {
            domId: 'chart_ycgd',
                zoomVal: 100,
            legend: ['在途超长工单', '挂起工单', '系统异常工单'],
            xData:  params3_data5.map(item => {
              return item.name;
            }),
            line_markLine: this.averageData.five_day_on_ways,
           line_markLine2: this.averageData.five_hand_ups,
           line_markLine3: this.averageData.five_except_order, 
            lineData1: params3_data5.map(item => {
                return Number(item.five_day_on_ways) || 0;
            }),
            lineData2: params3_data5.map(item => {
                return Number(item.five_hand_ups) ||  0;
            }),
            lineData3:  params3_data5.map(item => {
                return Number(item.five_except_order) ||  0;
            }),
        }
        echarts_zq.initEchart_lines(params3, clickCallback)


      };
      // 当天在途故障工单
      let params4_data = this.orderDataFn(jfbzAllData, 'guzhang_on_ways');
      var params4 = {
        domId: 'chart_rztgzgd',
            zoomVal: 100,
        legend: [],
        xData: params4_data.map(item => {
              return item.name;
        }),
        bar_markLine: this.averageData.guzhang_on_ways,
        // bar_markLine: 10,
        barData: params4_data.map(item => {
            return Number(item.guzhang_on_ways) ||  0;
        }),
        lineData: []
      }
      echarts_zq.initEchart_barLine(params4)

      // 当月完成故障工单
       let params5_data = this.orderDataFn(jfbzAllData, 'guzhang_mon_avg_length');
       var params5 = {
        domId: 'chart_rwcgzgd',
            zoomVal: 100,
        legend: ['工单数量', '平均处理时长'],
        xData:  params5_data.map(item => {
              return item.name;
        }),
        unit: '(分钟)',
        bar_markLine:  this.averageData.guzhang_mon_nums,
        line_markLine:  this.averageData.guzhang_mon_avg_length,
        
        barData: params5_data.map(item => {
            return Number(item.guzhang_mon_nums) ||  0;
        }),
        lineData: params5_data.map(item => {
            return Number(item.guzhang_mon_avg_length) ||  0;
        })
      }
      echarts_zq.initEchart_barLine(params5)


    },
    // 政企交付保障接口
    jfbzList () {
      var params = {
        or_he: this.or_he,
         "cityCode": this.cityCode
      }
      serviceApi.jfbzList(params).then(res => {
        if (res.rspCode == '0000') {
            var datal = res.result.data.filter(item => {
              return item.code != '0000'
            })
            this.jfbzAllData = datal;
            var avdatal = res.result.data.filter(item => {
              return item.code == '0000'
            })
            this.averageData = avdatal.length > 0 ? avdatal[0] : {}
              
              // zhihuiyan
              let params2_data = this.orderDataFn(datal, 'three_mon_avg_length');
              this.zhyData.name1 = params2_data[params2_data.length - 1].name
              this.zhyData.value1 = params2_data[params2_data.length - 1].three_mon_avg_length
     
              if (this.mapLevel == 1) {
                 this.zhyData.name1 = '泰安'
                 this.zhyData.value1  = '0.17'
              }


              let params2_data5 = this.orderDataFn(datal, 'five_mon_avg_length');

              this.zhyData.name2 = params2_data5[params2_data5.length - 1].name
              this.zhyData.value2 = params2_data5[params2_data5.length - 1].five_mon_avg_length;


               let params5_data = this.orderDataFn(datal, 'guzhang_mon_avg_length');
               this.zhyData.name3 = params5_data[params5_data.length - 1].name
              this.zhyData.value3 = params5_data[params5_data.length - 1].guzhang_mon_avg_length;

            this.initEchartFn()
         } else {
           this.$message.error(res.rspMsg)
         }
      })
    },
    // 业务保障
    ywbzList () {
      var self = this;
       // 临时写死
      if (this.mapLevel != 1) {
        return
      }
      var params = {
        or_he: this.or_he,
         "cityCode": this.cityCode
      };
      this.listData  = []
      serviceApi.ywbzList(params).then(res => {
        if (res.rspCode == '0000') {
          // res.result.data.forEach(element => {
          //   element.start_time = element.start_time.slice(5)
          //   element.end_time = element.end_time.slice(5)
          // });
          this.listData = res.result.data
          self.$nextTick(function () {
            self.$refs.seamlessScroll.reset()
          })
         
         } else {
           this.$message.error(res.rspMsg)
         }
      })
    },

    gismapListener (e) {
      var self = this;
      if (e.data.message == 'levelSwitch') {  
         self.gisTitle =  e.data.area_name ||  this.initgisTitle;
         self.mapLevel = e.data.level
         self.areaCode = e.data.area_id;
         self.gisMapData = e.data;
         self.gisQueryParams = Object.assign({},  self.gisQueryParams, e.data)
         self.gisQueryParams.area_name = '';
         console.log('message', e.data)
         self.cityCode = (e.data.area_id || '370000');
         self.initService()
      }
    },
    initGisMap (initArea_id) {
      // 初始化地图参数
         this.gisQueryParams =  {
             yanhuang: this.or_he,
             control: this.control.join(','),
             level: this.mapLevel,
              sceneid: 2,
              gis_sceneid: '0201',
              area_id: initArea_id,
              poi_city_id: '',
              system_type: 'C40',
              login_no:  store.get('staffId') || '',
              timest:  this.$store.state.resource.searchDate
          };
          var gisQueryParams = JSON.parse(JSON.stringify(this.gisQueryParams))
          this.iframeSrc =  window.gis_iframeSrc + `/smartEyes?${Qs.stringify(gisQueryParams)}`;
          
    },
    tabStatusFn (type) {
      this.tabstatus = type;
      this.initEchartFn()
      this.renderZtgd()
      var gisQueryParams = JSON.parse(JSON.stringify(this.gisQueryParams));
      gisQueryParams.message = "changeType";
       if (type == '3') {
        gisQueryParams.gis_sceneid = '0201'
      } else {
        gisQueryParams.gis_sceneid = '0202'
      };
      this.$refs['gisiframe'].contentWindow.postMessage(gisQueryParams, '*')
    },

    
  },
 destroyed() { // 在组件生命周期结束的时候销毁。
    window.removeEventListener('message',this.gismapListener, true)
  }
}
</script>

<style lang='scss' scoped>
  .contentbody {
    height: 100%;
    background: url('~@/assets/images/bigScreen/bg-left.png') left no-repeat, url('~@/assets/images/bigScreen/bg-right.png') right no-repeat;
    background-size: auto 100%;
    margin: -30px 15px 10px 15px;
    position: relative;
    display: flex;
  }
 .leftbox,  .rightbox {
   width: 480px;
   height: 100%;
   box-sizing: border-box;
   padding: 15px;
   padding-bottom: 30px;
 }
 .centerbox {
   flex: 1;
   background: url('~@/assets/images/images_zy/centerborder.png') no-repeat ;
   background-size: 100% 100%;
   margin-top: 10px;
   margin-bottom: 80px;
   box-sizing: border-box;
   position: relative;
   padding: 100px 20px 20px 20px;
   position: relative;

 }
//  .item-title {
//    font-size: 22px;
//    color: aqua;
//    background: url('~@/assets/images/images_zy/itemtitle.png') no-repeat ;
//    background-size: 100% 100%;
//    line-height: 38px;
//     padding-left: 58px;
//     position: relative;
//  }
   .item-title {
   font-size: 18px;
   color: aqua;
   background: url('~@/assets/images/bigScreen/titlebg.png') no-repeat;
   background-size: 100% 100%;
   line-height: 46px;
   padding-left: 36px;
   margin-bottom: 5px;
   font-weight: bolder;
 }
 .chartbox {
   width: 100%;
   height: 100%;
 }

 .gdjkitem {
   height: 68px;
   width: 72px;
   margin: 0 auto;
   background: url('~@/assets/images/images_zy/cire.png') no-repeat;
  background-size: 100% 100%;
  line-height: 68px;
  font-size: 18px;
  text-align: center;
  font-weight: bolder;
  
 }

 .gdjkitembox {
   text-align: center;
   position: relative;
   margin-top: 10px;
   cursor: pointer;
   &:not(:last-child)::after{
     content: '';
     display: block;
     width: 18px;
     height: 18px;
     background: url('~@/assets/images/images_zy/jiantou.png') no-repeat;
     background-size: 100% 100%;
     position: absolute;
     right: -8px;
     top: 26px;
   }
 }


.mtheader {
  text-align: center;
    line-height: 40px;
    font-size: 16px;
    color: #51d1ee;
    border-bottom: 1px solid #308497;
}
.mtbody {
  height: 100%;
  margin: 6px 0;
  box-sizing: border-box;
  overflow: hidden;
}
.mtbody .scrollitem {
  text-align: center;
  height: 34px;
  line-height: 34px;
  padding: 0 5px;
  font-size: 15px;
  box-sizing: border-box;
  overflow: hidden;
}

.scrollitem:nth-child(odd) {
  background: rgba(4,54,108,0.4);
}
.centTab {
   position: absolute;
   z-index: 10;
   width: 100%;
   top: 30px;
   text-align: center;
   .centtabitem {
    display: inline-block;
    height: 56px;
    width: 120px;
    line-height: 66px;
    text-align: center;
    font-size: 18px;
    cursor: pointer;
    color: rgb(2, 252, 252);
     background: url('~@/assets/images/images_zy/WechatIMG431.png') no-repeat;
    background-size: 100% 120%;
    margin-right: -15px;
    opacity: 0.5;
    
   }
    .centtabitem.active {
       opacity: 1;
    }
 }
 .morebtn {
   float: right;
   font-size: 14px;
   margin-right: 10px;
   cursor: pointer;
   color: #51d1ee;
 }
 .gdjkitem-font {
   color: #fff;
   font-size: 15px;
 }


 /deep/ .el-dialog {
  -webkit-transform: none;
  transform: none;
  left: 0;
  position: relative;
  z-index: 20000;
  margin: 0 auto;
  padding-bottom: 30px;
  background-image: url('~@/assets/images/bigScreen/kuang.png');
  background-size: 100% 100%;
  background-color: rgba(220, 38, 38, 0);
}

/deep/ .el-dialog__body {
  padding: 0px 20px;
}
/deep/ .el-dialog__headerbtn .el-dialog__close {
  color: #fff;
  font-size: 24px;
  font-weight: 500;
  margin: 2px 20px 0 0;
  border: 2px solid #193987;
  border-radius: 5px;
  background: #1e1e88;
}

/deep/ .el-table {
  background: none !important;
  font-size: 14px !important;
}
/deep/.dialogTableBg .el-table th {
  background: none !important;
  background: url('~@/assets/images/bigScreen/fullService/597bcdc505fa3.png') no-repeat !important;
  background-position: center 18px !important;
  background-size: contain !important;
  text-align: center !important;
  color: #02f6ff !important;
  font-size: 16px !important;
}

/deep/.dialogTableBg .el-table tr {
  background: none !important;
}

/deep/.dialogTableBg .el-table td {
  background: none !important;
  border: none !important;
  text-align: center !important;
  color: #ffffff;
  font-size: 16px  !important;
}
/deep/ .inittable2.el-table td {
  padding: 5px 0;
}
/deep/.el-table td.is-left {
  text-align: left !important;
}


/deep/.el-table td:first-child {
  background: none !important;
}

/deep/ .el-table th.is-leaf,
.el-table td {
  border: none !important;
  color: #ffffff;
}
/deep/.el-table::before {
  height: 0 !important;
}
/deep/.el-table th > .cell {
  display: contents !important;
}
/deep/.el-table .cell {
  padding: 0 6px;
}
/deep/ .dialogTableBg .el-table tr:nth-child(even) {
  background: rgba(4,54,108,0.4) !important;
}
.dialogCon {
  padding: 0 40px;
  .dialogTitle {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding-right: 30px;
    margin-top: 15px;
    .left {
      display: inline-block;
      padding-right: 110px;
      font-size: 24px;
      font-family: MFBanHei;
      font-weight: 400;
      color: #02f6ff;
      background-image: url('~@/assets/images/bigScreen/fullService/Rectangle 561.png');
      background-repeat: no-repeat;
      background-position: center right;
    }
    .title-right {
      color: #218cc8;
      font-size: 12px;
      font-family: Microsoft YaHei;
      div {
        width: 38px;
        height: 30px;
        line-height: 30px;
        text-align: center;
        display: inline-block;
        cursor: pointer;
        background-image: url('~@/assets/images/bigScreen/fullService/left-sub.png');
        background-repeat: no-repeat;
        background-size: 100% 100%;
      }
      .active {
        color: #02f6ff;
        background-image: url('~@/assets/images/bigScreen/fullService/left-subActive.png');
      }
    }
  }
}
.emptybox {
  position: relative;
  .exmptfont {
    position: absolute;
    top: 108px;
    width: 100%;
    text-align: center;
    font-size: 16px;
    color: #4fa1cf;
  }
}
.linkbtn {
  font-size: 16px;
  text-decoration: underline;
}
/deep/ .el-loading-mask {
    background-color: rgba(6,26,58, 0.7);
  }

   @keyframes turn{
      0%{-webkit-transform:rotate(0deg);}
      25%{-webkit-transform:rotate(90deg);}
      50%{-webkit-transform:rotate(180deg);}
      75%{-webkit-transform:rotate(270deg);}
      100%{-webkit-transform:rotate(360deg);}
  }
  .tjbtn {
     position: absolute;
    right: 60px;
    top: 40px;
    border-radius: 50%;
    padding: 4px;
    box-shadow: 0 0 10px rgb(56, 148, 235);
    cursor: pointer;
    animation:turn 8s linear infinite; 
    z-index: 99;
    img {
      width: 44px;
      z-index: 99;
    }
  }


 .tjtitle {
    color: #fff;
    font-size: 18px;
    font-weight: bolder;
    letter-spacing: 1px;
    background: linear-gradient(45deg, #1a92d4, transparent);
    line-height: 34px;
    padding-left: 15px;
    border-radius: 20px 0 0 20px;
    width: 60%;
  }
  .tjitem {
    // padding: 10px;
    color: #fff;
    font-size: 20px;
    p {
      line-height: 48px;
      margin-bottom: 0;
    }
  }
</style>