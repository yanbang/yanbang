<!--  -->
<template>
  <div class = "contentbox">
     <comheader :backbtn = false title="山东联通网络智慧眼"></comheader>
     <div class = "contentbody">
       <div class = "left-content">
          <div class="flexitem-box flex colflex" style="height: 260px">
             <div class = "item-title titlefont">
             <span>自主增效</span>
             <span class="tunit">(万元)</span>
              <span class="zdmore pull-right" @click="zbDetailFn('zzzx','自主增效')">详情》</span>
           </div>

           <div  class = "flex1">
              <div class="chartbox" id = "pieSx1"></div>
            </div>
          </div>
      
          <div class="flex1 flexitem-box" >
             <div class = "item-title titlefont" style="position: relative">
                <span>政企</span>
                <span class="zdmore pull-right" @click="zbDetailFn('zq','政企')">详情》</span>
              </div>
             <div class = "itemstitle">
                <div class="flex1 sitem">
                  <div><span class="numfont numfontclass" style="color: #FFCC00;line-height: 40px; ">{{fwyjData.userRoomCnt || '-'}}</span></div>
                  <div><img  style="width: 50px" src="@/assets/images/images_zy/jfindex.png" alt="" srcset=""></div>
                   <div >
                      <span class ="bgitem infofontcalss">用户机房数</span>
                      <!-- <span class="numfont"  style="color: rgb(250 176 113); margin-right: 15px; font-weight: bold">{{fwyjData.userRoomCnt || '-'}}</span> -->
                   </div>
                </div>

                <div class="flex1 sitem" style="cursor: pointer;" @click="zqkhdetailFn">
                  <div><span class="numfont numfontclass" style="color: #FFCC00;line-height: 40px; ">{{fwyjData.CustomerCnt || '-'}}</span></div>
                  <div><img  style="height: 50px" src="@/assets/images/images_zy/khindex2.png" alt="" srcset=""></div>
                   <div >
                      <span class ="bgitem infofontcalss">政企客户数</span>
                      <!-- <span class="numfont"  style="color: rgb(250 176 113); margin-right: 15px; font-weight: bold">{{fwyjData.userRoomCnt || '-'}}</span> -->
                   </div>
                </div>
                
               </div>
              <!-- <div class="chartbox flex1" style="height: 140px" id = "barchart_kd"></div> -->
          </div>
          <div class="flex1 flexitem-box">
             <div class = "item-title titlefont" style="margin-bottom: 10px">
               宽带
              <span class="zdmore pull-right" @click="zbDetailFn('kd','宽带')">详情》</span>
            </div>
             <div class = "flex flex1" style="padding-top: 0px">
               <div class = "flex1 wxitem">
                 <div class= "wxitem-tt">
                    <span class="numfont numfontclass">{{gxjzData.brasCnt || '--'}}</span>
                   
                 </div>
                 <div>
                   <div><img src="@/assets/images/images_zy/iconimg1.png" alt="" srcset=""></div>
                   <div class = "cblue infofontcalss">BRAS数</div>
                 </div>
               </div>

               <div class = "flex1 wxitem">
                 <div class= "wxitem-tt">
                     <span class="numfont numfontclass">{{gxjzData.oltCnt || '--'}}</span>
                 </div>
                 <div>
                   <div><img src="@/assets/images/images_zy/iconimg2.png" alt="" srcset=""></div>
                   <div class = "cblue infofontcalss">OLT数</div>
                 </div>
               </div>


               <div class = "flex1 wxitem">
                 <div class= "wxitem-tt">
                     <span class="numfont numfontclass">{{gxjzData.gigaEstateCnt || '--'}}</span>
                     <!-- <span>个</span> -->
                 </div>
                 <div>
                   <div><img src="@/assets/images/images_zy/iconimg3.png" alt="" srcset=""></div>
                   <div class = "cblue infofontcalss">千兆小区数</div>
                 </div>
               </div>
             </div>
          </div>

          <div class="flexitem-box flex colflex" style="height: 250px">
            <div class = "item-title titlefont">无线
              <span class="zdmore pull-right" @click="zbDetailFn('wx','无线')">详情》</span>
            </div>
            <div class = "flex flex1" style="padding-top: 10px">
              <!-- <div class="chartbox flex1" id = "barchar_wx" ></div> -->
             
              <div class="flex1 flex">
                <div class="flex1 jzitem">
                  <div class="numfont">{{gxjzData['3gStationCnt'] || '--'}}</div>
                  <div><img class="icimg" src="@/assets/resImg/3g.png" alt="" srcset=""></div>
                  <div class="nfont">3G基站</div>
                </div>
                <div class="flex1 jzitem">
                    <div class="numfont ">{{gxjzData['4gStationCnt'] || '--'}}</div>
                    <div><img class="icimg"  src="@/assets/resImg/4g.png" alt="" srcset=""></div>
                    <div class="nfont">4G基站</div>
                </div>
               <div class="flex1 jzitem">
                   <div class="numfont">{{gxjzData['5gStationCnt'] || '--'}}</div>
                    <div><img class="icimg"  src="@/assets/resImg/5g.png" alt="" srcset=""></div>
                    <div class="nfont">5G基站</div>
               </div>
              </div>
              <div class = " rcitem" style="width: 100px; text-align: center;">
                <div class="chartbox crbox jzitem"  style="line-height: 24px">
                    <div>
                      <span class = "numfont">{{gxjzData.oneStationDischarge || '--'}}</span>
                      <!-- <span style="font-size: 14px"> (GB)</span> -->
                    </div>
                    <div style="position: relative">
                      <div class="uniimg" style="text-align: center;
                        position: absolute;
                        top: 2px;
                        width: 100%;
                        font-size: 18px;
                        color: #5cb0d6;
                        font-weight: bold;">GB</div>
                      <img src="@/assets/images/images_zy/img2/icon-xuke 拷贝 2@2x(1).png" style="width: 80px; position: relative;top: 6px;" alt="" srcset="">
                    </div>
                    <div class = "nfont">4G单站流量</div>
                </div>
              </div>
            </div>
            
          </div>
      
          <!-- <div class="flex1 flexitem-box flex colflex">
                <div class = "item-title titlefont" style="margin-bottom: 0px">
                  <span>核心网</span>
                  <span class="tunit">(万户)</span>
                </div>
                <div  class = "flex1 flex bbitembox"  style="align-items: center;">
                   <div class = "flex1">
                     <div class = "imgbox"><img src="@/assets/images/images_zy/img2/icon-xuke@2x(1).png" style="width: 80px" alt="" srcset=""></div>
                     <div class = "bfontbox">
                       <div class = "numfont">{{fwyjData.internetThingsCapacity || '--'}}</div>
                       <div class="bfont">物联网</div>
                    </div>
                   </div>
                    <div class = "flex1">
                     <div class = "imgbox"><img src="@/assets/images/images_zy/img2/icon-xuke 拷贝@2x(1).png" style="width: 80px" alt="" srcset=""></div>
                     <div class = "bfontbox">
                       <div class = "numfont">{{fwyjData['5gCapacity'] || '--'}}</div>
                       <div class="bfont">5G网</div>
                    </div>
                   </div>
                    <div class = "flex1">
                     <div class = "imgbox"><img src="@/assets/images/images_zy/img2/icon-xuke 拷贝 2@2x(1).png" style="width: 80px" alt="" srcset=""></div>
                     <div class = "bfontbox">
                       <div class = "numfont">{{fwyjData['4gCapacity'] || '--'}}</div>
                       <div class="bfont">4G网</div>
                    </div>
                   </div>
                    <div class = "flex1">
                     <div class = "imgbox"><img src="@/assets/images/images_zy/img2/icon-xuke 拷贝 3@2x(1).png" style="width: 80px" alt="" srcset=""></div>
                     <div class = "bfontbox">
                       <div class = "numfont">{{fwyjData['3gCapacity'] || '--'}}</div>
                       <div class="bfont">3G网</div>
                    </div>
                   </div>
                   
                </div>
          </div> -->
       </div>

       <div class = "center-content">
         <div class = "ctop-box flex" style="height: 200px; position: relative; top: 0px">
           <dv-border-box-1 class = "felx">
                  <div class="flex1 flex ">
                    <div class=" flex colflex crilbox" style="padding-top: 10px; width: 140px;">
                      <div class = " chartbox" id = "anipie" style="height: 140px">
                      </div>
                      <div class = "cirfont">网运成本占比</div>
                    </div>
                    <div class="flex1 crilbox mkciritem chartbox " id = "centritemb" style="width: 230px;">
                      
                    </div>
                  </div>

                  <div class=" borderafter flex colflex" style="width: 410px;  position: relative; top: -5px">
                      <div class = "centtopbox_k" style=" position: relative; top: -4px">
                        <div class="flex1 numfont">
                          <div class="numfont">{{yzyData.resourcesIncomingUserCnt || '--'}}</div>
                          <div class="cirfont" style="font-size: 16px;">云资源入住客户数</div>
                        </div>
                        <div class="flex1 ">
                           <div class="numfont">
                             <span>{{yzyData.resourcesEarnings || '--'}}</span> 
                             <span class="titlefont" style="font-size: 16px"></span>
                            </div>
                           <div class="cirfont" style="font-size: 16px">云资源业务收入(万元)</div>
                        </div>
                      </div>

                      <div class = "centbotbox_k flex1">
                          <div class = "flex" style="background:#081846; line-height: 30px; margin-top: 5px; font-size: 18px">
                            <div class="flex1"> </div>
                            <div class="flex1">IT云 </div>
                            <div class="flex1">CT云</div>
                            <div class="flex1">业务云</div>
                          </div>

                         <div class = "flex scrollrow">
                            <div class="flex1" style="text-align: right">内存(G)</div>
                            <div class="flex1">{{yzyData.ITMemory}}</div>
                            <div class="flex1">{{yzyData.CTMemory}}</div>
                            <div class="flex1">{{yzyData.businessMemory}}</div>
                          </div> 
                          <div class = "flex scrollrow">
                            <div class="flex1" style="text-align: right">VCPU(个)</div>
                            <div class="flex1">{{yzyData.ITVCPU}}</div>
                            <div class="flex1">{{yzyData.CTVCPU}}</div>
                            <div class="flex1">{{yzyData.businessVCPU}}</div>
                          </div> 
                          <div class = "flex scrollrow">
                            <div class="flex1" style="text-align: right">储存总量(G)</div>
                            <div class="flex1">{{yzyData.ITStorage}} </div>
                            <div class="flex1">{{yzyData.CTStorage}}</div>
                            <div class="flex1">{{yzyData.businessStorage}}</div>
                          </div> 
                      </div>
                  </div>
                  <div class="flex1 tropbox" style="padding-top: 8px;">
                    <div class="numfont2">
                      <span class="numfont">{{yzyData.ICDOutletFlow || '-'}}</span>
                    </div>
                    <div class = "titlefont2">IDC出口总流量 <span class = "unit">(TB)</span></div>
                     <div class="numfont2">
                        <span class="numfont">{{yzyData.ICDBandwidth || '-'}}</span>
                      </div>
                    <div  class = "titlefont2">IDC总带宽 <span class = "unit">(TB)</span></div>
                  </div>
           </dv-border-box-1>
          
         </div>
         <div class = "cbottom-box">
            
             <div class = "gxinfoca">
               <div class="gxtitle titlefont">省际骨干互联网-实时</div>
               <div class="gxrow">
                 <span style="margin-right: 2px">总带宽:</span>
                 <span style="color: #FFCC00">{{sgxData.allBandwidth}} GB</span>
               </div>
               <div class="gxrow">
                 <span style="margin-right: 2px">最大流入:</span>
                 <span  style="color: #FFCC00">{{sgxData.flowIn}} GB</span>
               </div>
               <div class="gxrow">
                 <span style="margin-right: 2px">最大流出:</span>
                 <span  style="color: #FFCC00">{{sgxData.flowOut}} GB</span>
               </div>
               <div class="gxrow">
                 <span style="margin-right: 2px">流入带宽利用率:</span>
                 <span  style="color: #FFCC00">{{sgxData.flowInUseRate}} %</span>
               </div>
               <div class="gxrow">
                 <span style="margin-right: 2px">流出带宽利用率:</span>
                 <span  style="color: #FFCC00">{{sgxData.flowOutUseRate}} %</span>
               </div>
             </div>


            <div class="gistitle">
              <span class="titlefont">{{gisTitle}}</span>
            </div>
            <iframe  ref="gisiframe" id="gisiframe" :src="iframeSrc"  style="width: 100%; height: 100%" frameborder="0"></iframe>
         </div>
       </div>
       <div class = "right-content">
          <div class="flex1 flexitem-box " >
            <div class="flex" style="position: relative;">
               <div class = "item-title titlefont flex1 tabtitle" :class="{'active': tabtitleStatus == '1'}" @click="tabtitleStatus=1">用户数 <span class="tunit">(万户)</span></div>
               <div class = "item-title titlefont flex1 tabtitle" :class="{'active': tabtitleStatus == '2'}" @click="tabtitleStatus=2">电路数  <span class="tunit">(万条)</span> </div>
              
            </div>
            <div class="flex1">
               <span v-if= "tabtitleStatus == '1'" class="zdmore pull-right" @click="zbDetailFn('yhs','用户数')">详情》</span>
              <span v-if= "tabtitleStatus == '2'"  class="zdmore pull-right" @click="zbDetailFn('dls','电路数')">详情》</span>
               <div class="flex1 chartbox" id = "userPiechart" style="height: 200px; width: 100%" v-show= "tabtitleStatus == 1"></div>
               <div class="flex1 chartbox" id = "userPiechart2" style="height: 200px; width: 100%" v-show = "tabtitleStatus == 2"></div>
            </div>
          </div>
          <div class="flex1 flexitem-box" >
             <div class = "item-title titlefont">服务支撑
              <span class="zdmore pull-right" @click="zbDetailFn('fwzc','服务支撑')">详情》</span>
             </div>
              <div class = "flex flex1" style="margin-top: 15px">
               <div class = "flex1 wxitem">
                 <div class= "wxitem-tt">
                    <span class="numfont numfontclass">{{fwyjData.campUniformCnt || '-'}}</span>
                    <!-- <span>个</span> -->
                  </div>
                 <div>
                   <div><img src="@/assets/images/images_zy/iconr1.png" alt="" srcset=""></div>
                   <div class = "cblue">营服个数</div>
                 </div>
               </div>

               <div class = "flex1 wxitem">
                 <div class= "wxitem-tt">
                    <span class="numfont numfontclass">{{fwyjData.netCampCnt || '-'}}</span>
                    <!-- <span>个</span> -->
                 </div>
                 <div>
                   <div><img src="@/assets/images/images_zy/iconr2.png" alt="" srcset=""></div>
                   <div class = "cblue">网营个数</div>
                 </div>
               </div>


               <div class = "flex1 wxitem">
                 <div class= "wxitem-tt">
                    <span class="numfont numfontclass">{{fwyjData.netCampUserCnt || '-'}}</span>
                    <!-- <span>人</span> -->
                 </div>
                 <div>
                   <div><img src="@/assets/images/images_zy/iconr3.png" alt="" srcset=""></div>
                   <div class = "cblue">网营人员数</div>
                 </div>
               </div>

                <div class = "flex1 wxitem">
                 <div class= "wxitem-tt">
                    <span class="numfont numfontclass">{{fwyjData.smartAUserCnt || '-'}}</span>
                    <!-- <span>人</span> -->
                 </div>
                 <div>
                   <div><img src="@/assets/images/images_zy/iconr4.png" alt="" srcset=""></div>
                   <div class = "cblue">智家人员数</div>
                 </div>
               </div>
             </div>
          </div>
          <div class="flex1 flexitem-box" >
             <div class = "item-title titlefont">应急保障
               <span class="zdmore pull-right" @click="zbDetailFn('yjbz','应急保障')">详情》</span>
               </div>
              <div class = "flex flex1" style="margin-top: 15px">
               <div class = "flex1 wxitem">
                 <div class= "wxitem-tt">
                    <span class="numfont numfontclass">{{fwyjData.emergencyCommsBus || '-'}}</span>
                    <!-- <span>辆</span> -->
                  </div>
                 <div>
                   <div><img src="@/assets/images/images_zy/iconr5.png" alt="" srcset=""></div>
                   <div class = "cblue">应急通信车</div>
                 </div>
               </div>

               <div class = "flex1 wxitem">
                 <div class= "wxitem-tt">
                    <span class="numfont numfontclass">{{fwyjData.mobileOilMachine || '-'}}</span>
                    <!-- <span>台</span> -->
                 </div>
                 <div>
                   <div><img src="@/assets/images/images_zy/iconr6.png" alt="" srcset=""></div>
                   <div class = "cblue">移动油机</div>
                 </div>
               </div>


               <div class = "flex1 wxitem">
                 <div class= "wxitem-tt">
                    <span class="numfont numfontclass">{{fwyjData.capacityCrew || '-'}}</span>
                    <!-- <span>台</span> -->
                 </div>
                 <div>
                   <div><img src="@/assets/images/images_zy/iconry.png" alt="" srcset=""></div>
                   <div class = "cblue">应急人员</div>
                 </div>
               </div>


               <div class = "flex1 wxitem">
                 <div class= "wxitem-tt">
                    <span class="numfont numfontclass">{{fwyjData.capacityEmergencyEquipment || '-'}}</span>
                    <!-- <span>台</span> -->
                 </div>
                 <div>
                   <div><img src="@/assets/images/images_zy/iconzb.png" alt="" srcset=""></div>
                   <div class = "cblue">应急装备</div>
                 </div>
               </div>
             </div>
          </div>

         <!-- <div class="flex1 flexitem-box flex colflex">
              <div class = "item-title titlefont">线路<span class="tunit">(公里)</span></div>
                <div class="flex flex1 colflex" style="margin-top: 15px; margin-bottom: 10px;">
                      <div class="flex1 flex" style="margin-bottom: 10px;">
                        <div class="flex1 xlitem flex" style="margin-right: 10px">
                          <div style="width: 40px; text-align: center">
                            <img style="width: 36px; height: 36px; margin-top: 5px" src="@/assets/images/images_zy/gl2.png" alt="" srcset="">
                          </div>
                          <div class="flex1">
                              <div>
                                <span class="numfont">{{gxjzData.firstTrunkLine || '-'}}</span>
                                
                              </div>
                              <div class="gnfont">一干光缆(皮长)</div>
                          </div>
                        </div>
                        <div class="flex1 xlitem flex">
                           <div style="width: 40px; text-align: center;">
                            <img style="width: 36px; height: 36px; margin-top: 5px" src="@/assets/images/images_zy/gl.png" alt="" srcset="">
                          </div>
                          <div class="flex1">
                              <div>
                                <span class="numfont">{{gxjzData.localNetwork || '-'}}</span>
                               
                              </div>
                              <div class="gnfont">本地网光缆(皮长)</div>
                          </div>
                        </div>
                      </div>
                      <div class="flex1 flex" >
                        <div class="flex1 xlitem flex" style=" margin-right: 10px">
                           <div style="width: 40px; text-align: center;">
                            <img style="width: 36px; height: 36px; margin-top: 5px" src="@/assets/images/images_zy/gl2.png" alt="" srcset="">
                          </div>
                          <div class="flex1">
                              <div>
                                <span class="numfont">{{gxjzData.secondTrunkLine || '-'}}</span>
                              
                              </div>
                              <div class="gnfont">二干光缆(皮长)</div>
                          </div>
                        </div>
                        <div class="flex1 xlitem flex">
                           <div style="width: 40px; text-align: center;">
                            <img style="width: 40px; height: 40px; margin-top: 5px" src="@/assets/images/images_zy/guandao.png" alt="" srcset="">
                          </div>
                          <div class="flex1">
                              <div>
                                <span class="numfont">{{gxjzData.pipes || '-'}}</span>
                              
                              </div>
                              <div class="gnfont">管道(沟长)</div>
                          </div>
                        </div>
                      </div>
                </div>
         
           </div>  -->
          <div class=" felx colflex flexitem-box " style="height: 250px">
                <div class = "item-title titlefont">
                  <span>空间</span>
                    <span class="zdmore pull-right" @click="zbDetailFn('kj','空间')">详情》</span>
                </div>
                <div  class = "flex1 flex bbitembox " style="align-items: center;">
                   <div class = "flex1">
                      <div class = "numfont">{{gxjzData.icdCnt || '--'}}</div>
                     <div class = "imgbox"><img src="@/assets/images/images_zy/img2/icon-xuke@2x.png" style="width: 80px" alt="" srcset=""></div>
                     <div class = "bfontbox">
                       <div class="bfont">IDC中心数</div>
                    </div>
                   </div>
                     <div class = "flex1">
                        <div class = "numfont">{{gxjzData.kernelStationCnt || '--'}}</div>
                     <div class = "imgbox"><img src="@/assets/images/images_zy/img2/icon-xuke 拷贝 2@2x.png" style="width: 80px" alt="" srcset=""></div>
                     <div class = "bfontbox">
                      
                       <div class="bfont">核心局站数</div>
                    </div>
                   </div>
                    <div class = "flex1">
                       <div class = "numfont">{{gxjzData.convergedStationCnt || '--'}}</div>
                     <div class = "imgbox"><img src="@/assets/images/images_zy/img2/icon-xuke 拷贝@2x.png" style="width: 80px" alt="" srcset=""></div>
                     <div class = "bfontbox">
                      
                       <div class="bfont">汇聚局站数</div>
                    </div>
                   </div>
                  
                    <div class = "flex1">
                      <div class = "numfont">{{gxjzData.accessStationCnt || '--'}}</div>
                     <div class = "imgbox"><img src="@/assets/images/images_zy/img2/icon-xuke 拷贝 3@2x.png" style="width: 80px" alt="" srcset=""></div>
                     <div class = "bfontbox">
                       
                       <div class="bfont">接入局站数</div>
                    </div>
                   </div>
                   
                </div>
          </div>
       </div>
     </div>

      <el-dialog :visible.sync="isDialogShow" width="48%" :modal-append-to-body='false'>
        <div class="dialogCon">
          <div class="dialogTitle">
            <div class="left">政企客户详情</div>
          </div>
          <div class="dialogTableBg">
             <div class="chartbox flex1" style="height: 300px; width: 100%" id = "barchart_kd"></div>
          </div>
        </div>
      </el-dialog>


       <el-dialog :visible.sync="zbd_isDialogShow" width="50%" :modal-append-to-body='false'>
        <div class="dialogCon">
          <div class="dialogTitle">
            <div class="left">{{gisTitle}}-{{zbdetailTitle}}详情</div>
          </div>
          <div class="dialogTableBg">
              <el-table class="inittable2"  :data="zbdetailData" height="700px"  style="width: 100%;">
                <el-table-column v-for="(col, index)  in zbdetailColums" :key="index" :sortable = "col.sortable" :prop="col.filed" :label="col.title"> </el-table-column>
              </el-table>
          </div>
        </div>
      </el-dialog>
      <Footer :tabdata = "tabdata" class = "initfoot"></Footer>
  </div>
</template>

<script>
import echartInit from './echarts_component/echart_bardc'
import comheader from '@/components/resource_visual/header'
import Footer from '@/components/resource_visual/footer';
import store from 'store'
import { mapState } from 'vuex'
import  serviceApi from '@/api/resindexApi'
var _ = require('@/utils/lodash.js')
var Qs = require('@/utils/qs.js')
var userPiechart1 = null
var userPiechart2 = null
export default {
  data () {
    return {
      zbd_isDialogShow: false,
      isDialogShow: false,
      tabtitleStatus: 1,
      gisTitle: '山东省',
      tabdata: [
        {title: '政企', active: false, href: '/resource_visual/zhengqi_zhyx'},
        {title: '宽带', active: false, href: '/resource_visual/broadband_ceo'},
        {title: '无线', active: false, href: '/resource_visual/jsc_wxfn'},
        {title: '应急', active: false, href: '/resource_visual/emergencies_power'},
        {title: 'IDC', active: false, href: '/resource_visual/idcpage'},
      
        {title: '动力', active: false, href: ''},
        {title: '全网', active: false, href: '/resource_visual/network_index'}
      ],
      iframeSrc: '',
      gisQueryParams: {},
      queryParams: {},
      gisMapData: {},
      mapLevel: 1,
      areaCode: '',
      cityCode: '370000',
      yzyData: {},
      gxjzData: {},
      fwyjData: {},
      zyxxData: {},
      sgxData: {},
      zbdetailColums: [],
      zbdetailData: [],
      zbdetailTitle: '',
      control: [],
    }
  },
  components: {
    comheader,
    Footer
  },
  mounted () {
     var self = this;
     var initArea_id = '370000'
     this.mapLevel = 1;
     if (store.get('userInfo')) {
        var userInfo =  store.get('userInfo')
        var mapLevel = userInfo.levelAreaLevel;
        if (mapLevel == '1') {
          this.control = []
        } else if (mapLevel >= '2') {
          this.control = ['370000', userInfo.levelAreaCode]
        }
      };
     this.cityCode = initArea_id;
     this.initGisMap(initArea_id);

     // 注册地图事件
    window.addEventListener('message',self.gismapListener, true)
    this.initService()
  },
  watch: {
    tabtitleStatus (val) {
      if (val == 1) {
        this.$nextTick(() => {
         userPiechart1 && userPiechart1.$resize()
        })
      } else {
        this.$nextTick(() => {
         userPiechart2 && userPiechart2.$resize()
        })
      }
    }
  },
  computed: {
    ...mapState({
       searchDate: state => state.resource.searchDate,
    }),
  },
  methods: {
    zbDetailFn (type, title) {
      this.zbdetailTitle = title;
      this.zbd_isDialogShow = true;
      if (type == 'zq') {
        this.zbdetailColums = [
          {title: '地区', filed: 'name'},
          {title: '用户机房数', filed: 'userRoomCnt', sortable: true},
          {title: '政企客户数', filed: 'CustomerCnt', sortable: true},
        ]
      } else if (type == 'kd') {
        this.zbdetailColums = [
          {title: '地区', filed: 'name'},
          {title: 'BRAS数', filed: 'brasCnt', sortable: true},
          {title: 'OLT数', filed: 'oltCnt', sortable: true},
          {title: '千兆小区数', filed: 'gigaEstateCnt', sortable: true},
        ]
      }  else if (type == 'wx') {
        this.zbdetailColums = [
          {title: '地区', filed: 'name'},
          {title: '3G基站数', filed: 'StationCnt3g', sortable: true},
          {title: '4G基站数', filed: 'StationCnt4g', sortable: true},
          {title: '5G基站数', filed: 'StationCnt5g', sortable: true},
          {title: '4G单站流量(GB)', filed: 'oneStationDischarge', sortable: true},
          
        ]
      }  else if (type == 'fwzc') {
        this.zbdetailColums = [
          {title: '地区', filed: 'name'},
          {title: '营服个数', filed: 'campUniformCnt', sortable: true},
          {title: '网营个数', filed: 'netCampCnt', sortable: true},
          {title: '网营人员数', filed: 'netCampUserCnt', sortable: true},
          {title: '智A人员数', filed: 'smartAUserCnt', sortable: true},
        ]
      }  else if (type == 'yjbz') {
        this.zbdetailColums = [
          {title: '地区', filed: 'name'},
          {title: '应急通信车', filed: 'emergencyCommsBus', sortable: true},
          {title: '移动油机', filed: 'mobileOilMachine', sortable: true},
          {title: '应急人员', filed: 'capacityCrew', sortable: true},
          {title: '应急装备', filed: 'capacityEmergencyEquipment', sortable: true},
        ]
      }  else if (type == 'kj') {
        this.zbdetailColums = [
          {title: '地区', filed: 'name'},
          {title: 'IDC中心数', filed: 'idcCnt', sortable: true},
          {title: '核心局站数', filed: 'kernelStationCnt', sortable: true},
          {title: '汇聚局站数', filed: 'convergedStationCnt', sortable: true},
          {title: '接入局站数', filed: 'accessStationCnt', sortable: true},
        ]
      } else if (type == 'zzzx') {
         
        this.zbdetailColums = [
          {title: '地区', filed: 'name'},
          {title: 'ICT (万元)', filed: 'ICT', sortable: true},
          {title: '自建 (万元)', filed: 'selfbulidIncome', sortable: true},
          {title: '自优 (万元)', filed: 'selfServiveIncome', sortable: true},
          {title: '自修 (万元)', filed: 'selfRepairIncome', sortable: true},
          {title: '自营 (万元)', filed: 'selfOperateIncome', sortable: true},
        ]
      } else if (type == 'yhs') {
        this.zbdetailColums = [
          {title: '地区', filed: 'name'},
          {title: 'IPTV (万户)', filed: 'iptvUserCnt', sortable: true},
          {title: '移网 (万户)', filed: 'internetUserCnt', sortable: true},
          {title: '宽带 (万户)', filed: 'widebandUserCnt', sortable: true},
          {title: '物联网 (万户)', filed: 'internetThingsUserCnt', sortable: true},
        ]
      } else if (type == 'dls') {
        this.zbdetailColums = [
          {title: '地区', filed: 'name'},
          {title: '互联网专线 (万条)', filed: 'internetCircuitCnt', sortable: true},
          {title: '以太网专线 (万条)', filed: 'numCircuitCnt', sortable: true},
        ]
      }

    },
    // 指标详情
     serviceSyZblb () {
      var params = {
         "cityCode": this.cityCode
      }
      this.zbdetailData = []
      serviceApi.serviceSyZblb(params).then(res => {
        if (res.rspCode == '0000') {
           var datal = res.result.data || [];
           datal.forEach(item => {
             Object.keys(item).forEach(key => {
               Number(item[key])? item[key] =  Number(item[key]) : item[key];
            })
           });
           this.zbdetailData = datal;
         } else {
           this.$message.error(res.rspMsg)
         }
      })
    },
    zqkhdetailFn () {
      var params = {
         "cityCode": this.cityCode
      }
      this.isDialogShow = true;
      serviceApi.serviceSyGlkh(params).then(res => {
        if (res.rspCode == '0000') {
            var datal = res.result.data;
             var pieparams4 = {
              xAxis:datal.map(item => {
                return item.name
              }),
              data: datal,
              domId: 'barchart_kd',
            }
            this.$nextTick(() => {
              echartInit.initBarchart2(pieparams4)
            })
         } else {
           this.$message.error(res.rspMsg)
         }
      })  
    },
    initService () {
      this.serviceSyYzy() // 3.1.1云资源信息查询接口
      this.serviceSyGxjz() // 3.1.2干线基站信息查询接口
      this.serviceSyFwyj()//3.1.3服务应急信息查询接口
      this.serviceSyZyxx()//3.1.4用户资源信息查询接口
      this.serviceSyYsxx()//3.1.5应收信息查询接口
      this.serviceSySgx() //3.1.6省干线实时信息查询
      this.serviceSyZblb() // 5.1.10首屏各指标列表展示查询接口
    },
    serviceSyYzy () {
      var params = {
         "cityCode": this.cityCode
      }
      serviceApi.serviceSyYzy(params).then(res => {
        if (res.rspCode == '0000') {
           var datal = res.result.data[0] || {};
           this.yzyData = datal;
         } else {
           this.$message.error(res.rspMsg)
         }
      })
    },

    serviceSyGxjz () {
      var params = {
         "cityCode": this.cityCode
      }
      serviceApi.serviceSyGxjz(params).then(res => {
        if (res.rspCode == '0000') {
            var datal = res.result.data[0] || {};
            this.gxjzData = datal;
            // var pieparams2 = {
            //   domId: 'barchar_wx',
            //   jzdata: [datal['3gStationCnt'] || '0', datal['4gStationCnt'] || '0', datal['5gStationCnt'] || '0'],
            //   // jfdata: [datal['3gRoomCnt'] || '0', datal['4gRoomCnt'] || '0', datal['5gRoomCnt'] || '0'],
            // }
            // echartInit.initBarchart(pieparams2)

         } else {
           this.$message.error(res.rspMsg)
         }
      })
    },

    serviceSyFwyj () {
      var params = {
         "cityCode": this.cityCode
      }
      serviceApi.serviceSyFwyj(params).then(res => {
        if (res.rspCode == '0000') {
           var datal = res.result.data[0] || {};
           
            this.fwyjData = datal;
             var paramsUsers2 = {
                domId: 'userPiechart2',
                legend: ['互联网专线', '以太网专线'],
                name: '电路统计',
                data :[{
                  name: '互联网专线',
                  value: datal.internetCircuitCnt || '0'
                }, {
                  name: '以太网专线',
                  value: datal.numCircuitCnt || '0'
                }]
              }
            userPiechart2 =  new echartInit.initpiecir(paramsUsers2)

             
             
            
         } else {
           this.$message.error(res.rspMsg)
         }
      })
    },

    serviceSyZyxx () {
      var params = {
         "cityCode": this.cityCode
      }
      serviceApi.serviceSyZyxx(params).then(res => {
        if (res.rspCode == '0000') {
           
           var datal = res.result.data[0] || {};
           this.zyxxData = datal;
            var pieparams5 = {
              domId: 'anipie',
              value: datal.netOperatCostsRate || '0',

            }
            echartInit.initAnipie(pieparams5)
            // CES NPS
              if (this.cityCode == '370000') {
                var paramsb = {
                  domId: 'centritemb',
                  legend: ['CES', 'NPS'],
                  xAxis: ['宽带', '移网', '移动', '电信'],
                  series: [
                    [datal.widebandSatisfacte || '0', datal.shiftingNetSatisfacte || '0'],
                    [datal.widebandNps || '0', datal.shiftingNetNps || '0', datal.ydNps || '0',  datal.dxNps || '0'],
                  ]
                }
              } else {
                var paramsb = {
                  domId: 'centritemb',
                  legend: ['CES', 'NPS'],
                  xAxis: ['宽带', '移网',],
                  series: [
                    [datal.widebandSatisfacte || '0', datal.shiftingNetSatisfacte || '0'],
                    [datal.widebandNps || '0', datal.shiftingNetNps || '0'],
                  ]
                }
              }
              echartInit.initbarkk(paramsb)
              
              var paramsUsers = {
                domId: 'userPiechart',
                legend: ['IPTV', '移网', '宽带', '物联网'],
                data : [{
                    name: 'IPTV',
                    value: datal.iptvUserCnt || ''
                  }, {
                    name: '移网',
                    value: datal.internetUserCnt || ''
                  }, {
                    name: '宽带',
                    value: datal.widebandUserCnt || ''
                  }, {
                    name: '物联网',
                    value: datal.internetThingsUserCnt || ''
                  }]
              }
             userPiechart1 = new echartInit.initpiecir(paramsUsers)

         } else {
           this.$message.error(res.rspMsg)
         }
      })
    },

    serviceSyYsxx () {
      var params = {
         "cityCode": this.cityCode
      }
      serviceApi.serviceSyYsxx(params).then(res => {
        if (res.rspCode == '0000') {
              var datal = res.result.data[0] || {};
              var pieparams = {
                domId: 'pieSx1',
                data: [
                  {
                    value: datal.ICT,
                    name: 'ICT'
                  },
                  {
                    value: datal.selfbulidIncome,
                    name: '自建'
                  },
                  {
                    value: datal.selfServiveIncome,
                    name: '自维'
                  },               
                  {
                    value:datal.selfOptimizeIncome,
                    name: '自优'
                  },
                  {
                    value: datal.selfRepairIncome,
                    name: '自修'
                  },
                  {
                    value: datal.selfOperateIncome,
                    name: '自营'
                  },
                ]
              }
              echartInit.initpieZzsr(pieparams)
         } else {
           this.$message.error(res.rspMsg)
         }
      })
    },

    serviceSySgx () {
      var params = {
         "cityCode": this.cityCode
      }
      serviceApi.serviceSySgx(params).then(res => {
        if (res.rspCode == '0000') {
           var datal = res.result.data[0] || {};
           this.sgxData = datal;
         } else {
           this.$message.error(res.rspMsg)
         }
      })
    },


    gismapListener (e) {
      var self = this;
      if (e.data.message == 'levelSwitch') {
         self.gisTitle = e.data.area_name || '山东省'
         self.mapLevel = e.data.level
         self.areaCode = e.data.area_id;
         self.gisMapData = e.data;
         self.gisQueryParams = Object.assign({},  self.gisQueryParams, e.data)
         self.gisQueryParams.area_name = '';
         self.cityCode = e.data.area_id;
         self.initService()
         console.log('message', e.data)
        
      } else if (e.data.message == 'changeCity') {
         self.gisTitle = e.data.area_name || '山东省'
         self.mapLevel = e.data.level
         self.areaCode = e.data.area_id;
         self.gisMapData = e.data;
         self.gisQueryParams = Object.assign({},  self.gisQueryParams, e.data)
         self.gisQueryParams.area_name = '';
         self.cityCode = e.data.area_id;
         self.initService()
      }
    },
     initGisMap (initArea_id) {
      // 初始化地图参数
         this.gisQueryParams =  {
              control: this.control.join(','),
              level: this.mapLevel,
              sceneid: 1,
              gis_sceneid: '',
              area_id: initArea_id,
              poi_city_id: '',
              system_type: 'C40',
              login_no:  store.get('staffId') || '',
              timest:  this.$store.state.resource.searchDate
          };
          var gisQueryParams = JSON.parse(JSON.stringify(this.gisQueryParams))
          this.iframeSrc = window.gis_iframeSrc + `/smartEyes?${Qs.stringify(gisQueryParams)}`;
          
    },
  },
  destroyed() { // 在组件生命周期结束的时候销毁。
    window.removeEventListener('message',this.gismapListener, true)
  }
}
</script>

<style lang='less' scoped>
.tabtitle {
  opacity: 0.5;
  cursor: pointer;
}
.tabtitle.active {
  opacity: 1;
}
/deep/ .bottom-tab{
  width: 60%;
  bottom:8px;
}

/deep/ .bottom-tab .bottom-item {
  padding: 4px 20px;
}
.bottom-tab .bottom-item
.crbox {
  text-align: center;
}
.flex1 {
  flex: 1;
}
.flex {
  display: flex;
} 
.colflex {
  flex-direction: column;
}
.contentbody {
  flex: 1;
  display: flex;
  padding: 15px;
  box-sizing: border-box;
  background: url('~@/assets/images/bigScreen/bg-left.png') left no-repeat, url('~@/assets/images/bigScreen/bg-right.png') right no-repeat;
  background-size: auto 100%;
  margin: 15px 10px 10px 10px;
  position: relative;
}
.left-content, .right-content {
  width: 420px;
  display: flex;
  flex-direction: column;
}
.center-content {
  flex: 1;
  padding: 0 15px;
  box-sizing: border-box;
  display: flex;
  flex-direction: column;
}

.flexitem-box {
  margin-bottom: 10px;
  box-sizing: border-box;
}

 .item-title {
   font-size: 18px;
   color: aqua;
  //  background: url('~@/assets/images/images_zy/itemtitle.png') no-repeat ;
   background: url('~@/assets/images/bigScreen/titlebg.png') no-repeat;
   background-size: 100% 100%;
   line-height: 46px;
   padding-left: 36px;
   margin-bottom: 5px;
   font-weight: bolder;
 }
.left-content .flexitem-box:last-child,  .right-content .flexitem-box:last-child{
 margin-bottom: 0px;
}
.ctop-box {
  margin-bottom: 10px;
}
.cbottom-box {
  flex: 1;
  box-sizing: border-box;
   background: url('~@/assets/images/images_zy/中框线@2x.png') no-repeat ;
   background-size: 100% 100%;
   margin-top: 10px;
   margin-bottom: 70px;
   box-sizing: border-box;
   position: relative;
   padding: 20px 20px 20px 20px;
   position: relative;
   .gxinfoca {
     position: absolute;
     bottom: 20px;
     right: 15px;
     padding: 10px 15px;
     background: transparent;
     border-radius: 5px;
     background: rgba(0, 0, 0, 0.1);
     box-shadow: 0 0 10px rgb(13, 65, 133);
    
     .gxtitle {
       font-size: 16px;
       text-align: center;
       border-bottom: 1px solid rgb(28, 104, 167);
       line-height: 32px;
       margin-bottom: 6px;
     }
     .gxrow {
       line-height: 28px;
       font-size: 15px;

     }
   }
 
}
.text-center {
   text-align: center;
}
.wxitem {
  font-size: 16px;
  text-align: center;
  .wxitem-tt {
    
    color: #FFCC00;
    line-height: 38px;
    font-weight: bold;
  }
  img {
    width: 50px;
    margin-bottom: 10px;
  }
}
.itemstitle {
  display: flex;
  text-align: center;
  margin-top: 20px;
}

.chartbox {
  width: 100%;
  height: 100%;
}

.crilbox {
  text-align: center;
  // padding-top: 30px;
}
/deep/ .el-progress__text {
  color: #fff;
  font-size: 14px !important;
}
.cirfont {
  font-size: 16px;
  color: #fff;
}

/deep/ .mkciritem .el-progress__text{
  font-size: 11px !important;
    width: 60px;
    margin: 0 auto;
    margin-left: 16px;
    line-height: 16px;
}
#barchar_wx {
  position: relative;
}
#barchar_wx::after {
  content: '';
  display: block;
  background: url('~@/assets/images/bigScreen/resource/split.png') no-repeat;
  background-size: 100% 100%;
  height: 80%;
  width: 1px;
  margin-left: 10px;
  position: absolute;
  right: -5px;
  top: 20px;
}
.borderafter {
  position: relative;
  padding: 0 10px;
  box-sizing: border-box;
}
.borderafter::after {
  content: '';
  display: block;
  background: url('~@/assets/images/bigScreen/resource/split.png') no-repeat;
  background-size: 100% 100%;
  height: 80%;
  width: 1px;
  margin-left: 10px;
  position: absolute;
  right: 0px;
  top: 20px;
}

.borderafter::before {
  content: '';
  display: block;
  background: url('~@/assets/images/bigScreen/resource/split.png') no-repeat;
  background-size: 100% 100%;
  height: 80%;
  width: 1px;
  margin-left: 10px;
  position: absolute;
  left: -10px;
  top: 20px;
}
.cblue {
  color: rgb(232, 250, 253) !important;
  line-height: 40px;
  font-size: 18px;
}
.bgitem {
  // background: #22a4aa6b;
  border-radius: 5px;
  
}
.bbitembox {
  text-align: center;
  margin-top: 20px;
  .numfont {
    font-size: 22px;
    color: #FFCC00;
    font-weight: bolder;
  }
}
.bbitembox .flex1 {
  position: relative;
  .imgbox {
   text-align: center;
  }
}

.bfontbox {
  .bfont {
    color: rgb(232, 250, 253);
    font-size: 18px;
    line-height: 40px;
  }

}
/deep/ .border-box-content {
  display: flex;
  padding: 10px;
}

.centtopbox_k {
  height: 65px;
   background: url('~@/assets/images/images_zy/img2/bg@2x.png') no-repeat;
  background-size: 100% 100%;
  text-align: center;
  display: flex;
  padding: 5px;
  box-sizing: border-box;
  .numfont {
    color: #FFCC00;
    font-size: 20px;
    line-height: 30px;
    height: 30px;
  }
  .cirfont {
    line-height: 22px;
  }
}
.centbotbox_k {
  text-align: center;
  .scrollrow {
    color: #e0f1f5;
    line-height: 30px;
    border-bottom: 1px dashed #152f5f;
    font-size: 16px;
    .flex1 {
      padding: 0 5px;
    }
  }
}

.tropbox {
  text-align: center;
  .numfont2 {
    color: #FFCC00;
    font-size: 22px;
    line-height: 40px;
    height: 40px;
    margin-top: 10px;
    .unit {
      color: #fff;
      font-size: 18px;
      font-weight: bolder;
    }
  }
  .titlefont2 {
    font-size: 20px;
    font-weight: bolder;
    .unit{
      font-size: 18px;
      font-weight: normal;
    }
  }
}

.tooltipbox {
  position: absolute;
  width: 100%;
  background: rgba(0, 0, 0, 0.6);
  bottom: 0;
  line-height: 24px;
  font-size: 13px;
  z-index: 99;
  transition: all 0.3s linear;
  overflow: hidden;
  height: 0px;
   box-sizing: border-box;
}
.jzitem {
  text-align: center;
  .numfont {
    font-size: 20px;
    color: #FFCC00;
    line-height: 50px;
    font-weight: bolder;
  }
  .icimg {
    height: 70px;
    margin-top: 10px;
  }
  .nfont {
    color:  #e8fafd;
    font-size:18px;
    line-height: 40px;
  }
}

.xlitem {
  background: url('~@/assets/images/images_zy/img2/bg@2x.png') no-repeat;
  background-size: 100% 100%;
  line-height: 24px;
  padding: 5px;
  text-align: center;
  height: 60px;
  .numfont {
    font-size: 18px;
    color: #FFCC00;
  }
  .numinfo {
    font-size: 12px;
    color: #FFCC00;
    margin-left: 3px;
  }
  .gnfont {
    color:  #00CCFF;
    font-weight: bolder;
    font-size:15px;
  }
}
.tunit {
  font-size: 16px;
  margin-left: 2px;
}


.gistitle {
  position: absolute;
  left: 30px;
  top: 20px;
  font-size: 24px;
  color: aqua;

}
/deep/ .el-dialog {
  -webkit-transform: none;
  transform: none;
  left: 0;
  position: relative;
  z-index: 20000;
  margin: 0 auto;
  padding-bottom: 30px;
  background-image: url('~@/assets/images/bigScreen/kuang.png');
  background-size: 100% 100%;
  background-color: rgba(220, 38, 38, 0);
}

/deep/ .el-dialog__body {
  padding: 0px 20px;
}
/deep/ .el-dialog__headerbtn .el-dialog__close {
  color: #fff;
  font-size: 24px;
  font-weight: 500;
  margin: 2px 20px 0 0;
  border: 2px solid #193987;
  border-radius: 5px;
  background: #1e1e88;
}
 .dialogCon {
  padding: 0 40px;
  .dialogTitle {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding-right: 30px;
    .left {
      display: inline-block;
      padding-right: 110px;
      font-size: 24px;
      font-family: MFBanHei;
      font-weight: 400;
      color: #02f6ff;
      background-image: url('~@/assets/images/bigScreen/fullService/Rectangle 561.png');
      background-repeat: no-repeat;
      background-position: center right;
    }
    .title-right {
      color: #218cc8;
      font-size: 12px;
      font-family: Microsoft YaHei;
      div {
        width: 38px;
        height: 30px;
        line-height: 30px;
        text-align: center;
        display: inline-block;
        cursor: pointer;
        background-image: url('~@/assets/images/bigScreen/fullService/left-sub.png');
        background-repeat: no-repeat;
        background-size: 100% 100%;
      }
      .active {
        color: #02f6ff;
        background-image: url('~@/assets/images/bigScreen/fullService/left-subActive.png');
      }
    }
  }
}
.numfontclass {
  font-size: 22px !important;
  line-height: 50px !important;
  font-weight: 500 !important;
}
.infofontcalss {
  font-size: 18px !important;
  color: rgb(232, 250, 253) !important;
  line-height: 50px !important;
}
.zdmore {
  float: right;
  font-size: 16px;
  cursor: pointer;
  color: #57b4f1;
  margin-right: 0px;
  text-decoration: underline;
  position:relative;
  z-index: 999
}


/deep/ .el-table {
  background: none !important;
  font-size: 15px !important;
}
/deep/.dialogTableBg .el-table th {
  background: none !important;
  background: url('~@/assets/images/bigScreen/fullService/597bcdc505fa3.png') no-repeat !important;
  background-position: center 11px !important;
  background-size: contain !important;
  text-align: center !important;
  color: #02f6ff !important;
  font-size: 15px !important;
}

/deep/ .el-table tr {
  background: none !important;
}

/deep/.el-table td {
  background: none !important;
  border: none !important;
  text-align: center !important;
  color: #ffffff;
}
/deep/ .inittable2.el-table td {
  padding: 6px 0;
}
/deep/.el-table td.is-left {
  text-align: left !important;
}


/deep/.el-table td:first-child {
  background: none !important;
}

/deep/ .el-table th.is-leaf,
.el-table td {
  border: none !important;
  color: #ffffff;
}
/deep/.el-table::before {
  height: 0 !important;
}
/deep/.el-table th > .cell {
  display: contents !important;
}
/deep/.el-table .cell {
  padding: 0 6px;
}
/deep/ .dialogTableBg .el-table tr:nth-child(even) {
  background: rgba(4,54,108,0.4) !important;
}
</style>