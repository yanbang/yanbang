<!--  -->
<template>
  <div class="contentbody_zt">
    <div class="tjtime">
      统计时间: 10月份
      <el-tooltip class="item" content="指标口径说明" placement="right">
        <span class="el-icon-question tooltipzb_zt" @click="explainFn"></span>
      </el-tooltip>
    </div>
    <div class="mytabs" style="min-height: 720px">
      <el-tabs v-model="activeName" type="card">
        <el-tab-pane label="OLT专题" name="1">
          <el-table class="custom_table grouptable groupheadtable" :data="oltTabledata" size="mini" height="680px">
            <el-table-column prop="name" label="组织机构"> </el-table-column>
            <el-table-column prop="olt_rate_avg" label="OLT设备月度平均退服率" sortable align="center">
              <template slot-scope="scope">
                <span>{{ scope.row['olt_rate_avg'] | formatVal }}%</span>
              </template>
            </el-table-column>
            <el-table-column prop="pon_rate_avg" label="PON口平均月度退服率" sortable align="center">
              <template slot-scope="scope">
                <span>{{ scope.row['pon_rate_avg'] | formatVal }}%</span>
              </template>
            </el-table-column>
            <el-table-column prop="olt_tworate" label="OLT双路由占比" sortable align="center">
              <template slot-scope="scope">
                <span>{{ scope.row['olt_tworate'] | formatVal }}%</span>
              </template>
            </el-table-column>
            <el-table-column prop="olt_ponrate" label="PON口退服率" sortable align="center">
              <template slot-scope="scope">
                <span>{{ scope.row['olt_ponrate'] | formatVal }}%</span>
              </template>
            </el-table-column>
            <el-table-column prop="olt_retrun_rate" label="OLT退服率" sortable align="center">
              <template slot-scope="scope">
                <span>{{ scope.row['olt_retrun_rate'] | formatVal }}%</span>
              </template>
            </el-table-column>
          </el-table>
        </el-tab-pane>
        <el-tab-pane label="FTTH专题" name="2">
          <div class="flex">
            <div class="flex1">
              <div class="stitle">
                FTTH全省统计分析
              </div>
              <div>
                <el-table :data="ftthTabledata1" size="mini" height="700px">
                  <el-table-column prop="name" width="100px" label="组织机构"> </el-table-column>
                  <el-table-column prop="ftth_num" label="FTTH在线终端数" sortable> </el-table-column>
                  <el-table-column prop="ftth_12gs" label="大于12天小于-30DB大光衰数" sortable> </el-table-column>
                  <el-table-column prop="ftth_30gs" label="小于-30DB大光衰质差占比" sortable>
                    <template slot-scope="scope">
                      <span>{{ scope.row['ftth_30gs'] | formatVal }}%</span>
                    </template>
                  </el-table-column>
                  <el-table-column prop="ftth_rate" label="总劣化率" sortable>
                    <template slot-scope="scope">
                      <span>{{ scope.row['ftth_rate'] | formatVal }}%</span>
                    </template>
                  </el-table-column>
                </el-table>
              </div>
            </div>
            <div class="" style="margin-left: 20px; width: 640px">
              <div class="stitle">FTTH区县劣化占比排名</div>
              <div style="border-left: 1px dashed #074476">
                <el-table :data="ftthTabledata2" size="mini" height="700px">
                  <el-table-column prop="parent_name" width="80px" label="地市"> </el-table-column>
                  <el-table-column prop="name" label="区县"> </el-table-column>
                  <el-table-column prop="ftth_rate" label="ftth劣化占比" sortable>
                    <template slot-scope="scope">
                      <span>{{ scope.row['ftth_rate'] | formatVal }}%</span>
                    </template>
                  </el-table-column>
                  <el-table-column prop="rn" label="排名" sortable> </el-table-column>
                </el-table>
              </div>
            </div>
          </div>
        </el-tab-pane>
      </el-tabs>
    </div>
  </div>
</template>

<script>
import serviceApi from '@/api/health_zt'
export default {
  data() {
    return {
      zbDialogShow: false,
      zbDataList: [],
      vloading: false,
      cityCode: '370000',
      activeName: '1',
      oltTabledata: [],
      ftthTabledata1: [],
      ftthTabledata2: []
    }
  },

  components: {},

  computed: {},

  mounted() {
    this.initService()
  },

  methods: {
    explainFn() {
      //debugger
      this.$EventBus.$emit('explainFn', { code: 'healthy_zt', title: '健康度-专题' })
    },
    initService() {
      this.servicejkdOltzhuanti()
      this.servicejkdFtthzhuanti()
      this.servicejkdFttharray()
    },
    initSortTabledata(datas, nokeys) {
      var datal = _.cloneDeep(datas)
      datal.forEach(item => {
        Object.keys(item).forEach(key => {
          if (nokeys && nokeys.indexOf(key) == -1) {
            Number(item[key]) || Number(item[key]) === 0 ? (item[key] = Number(item[key])) : item[key]
          }
        })
      })

      return datal
    },
    servicejkdOltzhuanti() {
      var params = {
        cityCode: this.cityCode
      }
      serviceApi.servicejkdOltzhuanti(params).then(res => {
        if (res.rspCode == '0000') {
          var datal = res.result.data || []
          this.oltTabledata = this.initSortTabledata(datal, ['code'])
        } else {
          this.$message.error(res.rspMsg)
        }
      })
    },
    servicejkdFtthzhuanti() {
      var params = {
        cityCode: this.cityCode
      }
      serviceApi.servicejkdFtthzhuanti(params).then(res => {
        if (res.rspCode == '0000') {
          var datal = res.result.data || []
          this.ftthTabledata1 = this.initSortTabledata(datal, ['code'])
        } else {
          this.$message.error(res.rspMsg)
        }
      })
    },
    servicejkdFttharray() {
      var params = {
        cityCode: this.cityCode
      }
      serviceApi.servicejkdFttharray(params).then(res => {
        if (res.rspCode == '0000') {
          var datal = res.result.data || []
          this.ftthTabledata2 = this.initSortTabledata(datal, ['code'])
        } else {
          this.$message.error(res.rspMsg)
        }
      })
    }
  }
}
</script>
<style lang="scss" scoped>
@import url('../comtable.scss');
.tjtime {
  font-size: 20px;
  margin-bottom: 10px;
  color: aqua;
}
.contentbody_zt {
  width: 100%;
  height: 100%;
  color: #fff;
}
.panebox {
  min-height: 700px;
}
/deep/ .mytabs .el-tabs__item {
  font-size: 16px !important;
}
/deep/ .mytabs .el-tabs__item.is-active {
  color: #02f6ff !important;
}
/deep/ .mytabs .el-tabs__item {
  color: #92a9d8;
  position: relative;
}
/deep/ .el-table__fixed-header-wrapper,
/deep/ .el-table__fixed-body-wrapper {
  background: #00123f !important;
}
/deep/ .el-table__fixed::before {
  content: '';
  position: absolute;
  left: 0;
  bottom: 0;
  width: 100%;
  height: 1px;
  background-color: transparent !important;
  z-index: 4;
}
.stitle {
  font-size: 16px;
  color: #fff;
  padding-left: 15px;
  border-left: 4px solid #2fc5e7;
  border-bottom: 1px solid #074476;
  line-height: 34px;
  background: linear-gradient(left, rgb(27, 49, 109), rgb(1, 16, 53));
}

.tooltipzb_zt {
  font-size: 20px;
  position: relative;
  color: #9abbdd;
  cursor: pointer;
  z-index: 99;
  margin-left: 20px;
}
</style>
